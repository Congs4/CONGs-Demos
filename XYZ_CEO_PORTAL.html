<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XYZ Distribution CEO Portal - 2026 Strategic Planning</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --brand-red: #FF3333;
            --brand-dark: #2E2E2E;
            --brand-blue: #00AEEF;
            --brand-light: #EFEFEF;
            --positive: #28a745;
            --negative: #dc3545;
            --warning: #f59e0b;
            --purple: #8b5cf6;
            --white: #ffffff;
            --border: #d4d4d4;
            --text-muted: #666;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--brand-light);
            color: var(--brand-dark);
            line-height: 1.6;
            font-size: 13px;
        }
        
        /* Header */
        .header {
            background: var(--brand-dark);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 4px;
        }
        
        .logo span { color: var(--brand-red); }
        
        .header-subtitle {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        .header-right {
            text-align: right;
            font-size: 12px;
        }
        
        .header-right .date { opacity: 0.7; }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--white);
            border-bottom: 3px solid var(--brand-red);
            padding: 0 20px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 14px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: var(--brand-dark);
            background: rgba(0,0,0,0.02);
        }
        
        .nav-tab.active {
            color: var(--brand-red);
            border-bottom-color: var(--brand-red);
        }
        
        /* Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 25px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards */
        .section {
            background: var(--white);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--brand-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--brand-red);
            display: inline-block;
        }
        
        /* Scorecards */
        .scorecards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 25px;
        }
        
        .scorecard {
            background: var(--white);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-top: 4px solid var(--brand-blue);
        }
        
        .scorecard.highlight { border-top-color: var(--brand-red); }
        .scorecard.green { border-top-color: var(--positive); }
        .scorecard.warning { border-top-color: var(--warning); }
        
        .scorecard-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--brand-dark);
        }
        
        .scorecard-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .scorecard-change {
            font-size: 13px;
            margin-top: 8px;
            font-weight: 600;
        }
        
        .positive { color: var(--positive); }
        .negative { color: var(--negative); }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th {
            background: var(--brand-dark);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th.text-right, td.text-right { text-align: right; }
        th.text-center, td.text-center { text-align: center; }
        
        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover { background: #f8f9fa; }
        
        tr.total-row {
            background: #f0f4f8;
            font-weight: 700;
        }
        
        tr.total-row td {
            border-top: 2px solid var(--brand-dark);
        }
        
        /* Editable inputs */
        .editable-input {
            background: #f8f9fa;
            border: 1px solid var(--border);
            color: var(--brand-dark);
            padding: 6px 8px;
            border-radius: 4px;
            width: 80px;
            text-align: right;
            font-size: 12px;
            font-family: inherit;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: var(--brand-blue);
            background: white;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-red { background: rgba(255,51,51,0.15); color: var(--brand-red); }
        .badge-blue { background: rgba(0,174,239,0.15); color: var(--brand-blue); }
        .badge-green { background: rgba(40,167,69,0.15); color: var(--positive); }
        .badge-warning { background: rgba(245,158,11,0.15); color: var(--warning); }
        .badge-purple { background: rgba(139,92,246,0.15); color: var(--purple); }
        
        /* Strategic Box */
        .strategic-box {
            background: linear-gradient(135deg, var(--brand-dark) 0%, #1a1a1a 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .strategic-box h3 {
            color: var(--brand-red);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .strategic-table {
            background: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            width: 100%;
            border-collapse: collapse;
        }
        
        .strategic-table th {
            background: var(--brand-dark);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }
        
        .strategic-table td {
            border-bottom: 1px solid #e0e0e0;
            color: var(--brand-dark);
            padding: 10px 15px;
            font-size: 13px;
        }
        
        .strategic-table tr:hover { background: rgba(0,0,0,0.03); }
        
        .strategic-table .text-right { text-align: right; }
        .strategic-table .text-center { text-align: center; }
        
        .bottom-line {
            background: var(--brand-red);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        
        @media (max-width: 1200px) { .grid-3, .grid-4 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; } }
        
        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Highlight boxes */
        .highlight-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            height: 100%;
        }
        
        .highlight-header {
            font-size: 12px;
            font-weight: 700;
            color: var(--brand-dark);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid;
        }
        
        .highlight-header.red { border-color: var(--brand-red); }
        .highlight-header.blue { border-color: var(--brand-blue); }
        .highlight-header.green { border-color: var(--positive); }
        
        .highlight-item {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .highlight-item:last-child { border-bottom: none; }
        
        /* Layer Cards */
        .layer-card {
            background: var(--white);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .layer-name {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .layer-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--brand-dark);
            margin-bottom: 12px;
        }
        
        .layer-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            outline: none;
        }
        
        .layer-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--brand-red);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(255,51,51,0.4);
        }
        
        .layer-impact {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .layer-impact .impact-amount {
            color: var(--positive);
            font-weight: 600;
        }
        
        .layer-impact .impact-share {
            color: var(--brand-blue);
            font-weight: 600;
            font-size: 11px;
        }
        
        .layer-description {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--border);
            line-height: 1.4;
            font-style: italic;
        }
        
        /* Waterfall Visualization */
        .waterfall-container {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--white);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .waterfall-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }
        
        .waterfall-chart {
            display: flex;
            align-items: flex-end;
            height: 180px;
            gap: 8px;
            padding: 0 10px;
        }
        
        .waterfall-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .waterfall-bar-inner {
            width: 100%;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
            position: relative;
        }
        
        .waterfall-bar-label {
            font-size: 9px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 8px;
            line-height: 1.2;
        }
        
        .waterfall-bar-value {
            font-size: 11px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .waterfall-baseline { background: var(--brand-dark); }
        .waterfall-layer1 { background: #00AEEF; }
        .waterfall-layer2 { background: #28a745; }
        .waterfall-layer3 { background: #ffc107; }
        .waterfall-layer4 { background: #6f42c1; }
        .waterfall-total { background: var(--brand-red); }
        
        .waterfall-connector {
            position: absolute;
            right: -12px;
            top: 0;
            width: 12px;
            border-top: 2px dashed #ccc;
        }
        
        /* Percentage Breakdown Bar */
        .growth-breakdown {
            margin-top: 20px;
        }
        
        .breakdown-title {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .breakdown-bar {
            height: 32px;
            background: #f0f0f0;
            border-radius: 4px;
            display: flex;
            overflow: hidden;
        }
        
        .breakdown-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            transition: width 0.3s ease;
            min-width: 0;
            overflow: hidden;
            white-space: nowrap;
        }
        
        .breakdown-segment.layer1 { background: #00AEEF; }
        .breakdown-segment.layer2 { background: #28a745; }
        .breakdown-segment.layer3 { background: #ffc107; color: #333; }
        .breakdown-segment.layer4 { background: #6f42c1; }
        
        .breakdown-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
            font-size: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        /* Help Tooltips */
        .help-tip {
            position: relative;
            cursor: help;
        }
        
        .help-tip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 400;
            white-space: normal;
            width: 280px;
            line-height: 1.4;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .help-tip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Region cards */
        .region-card {
            background: var(--white);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        
        .region-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--brand-dark);
            margin-bottom: 8px;
        }
        
        .region-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .region-dealers {
            font-size: 11px;
            color: var(--brand-blue);
        }
        
        /* P&L Inputs */
        .pl-input-group {
            margin-bottom: 15px;
        }
        
        .pl-input-group label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .pl-input-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .pl-input-group input:focus {
            outline: none;
            border-color: var(--brand-blue);
        }
        
        .pl-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .pl-result-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--positive);
        }
        
        .pl-result-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        /* Note box */
        .note {
            background: #f0f7ff;
            border-left: 4px solid var(--brand-blue);
            padding: 12px 16px;
            margin: 15px 0;
            font-size: 12px;
            border-radius: 0 6px 6px 0;
        }
        
        /* Tag */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            margin-right: 4px;
        }
        
        .tag-positive { background: #d4edda; color: #155724; }
        .tag-negative { background: #f8d7da; color: #721c24; }
        .tag-neutral { background: #fff3cd; color: #856404; }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            border: none;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--brand-red);
            color: white;
        }
        
        .btn-primary:hover {
            background: #e62e2e;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--brand-dark);
            color: white;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            color: var(--text-muted);
            font-size: 11px;
        }
        
        
        
        /* Print Styles */
        @media print {
            /* Hide navigation and interactive elements */
            .nav-tabs { display: none !important; }
            button { display: none !important; }
            input[type="range"] { display: none !important; }
            input[type="number"] { 
                border: none !important; 
                background: transparent !important;
                -webkit-appearance: none;
                -moz-appearance: textfield;
            }
            
            /* Hide How to Use guide in print */
            #guide { display: none !important; }
            
            /* Show only the currently active tab, not all tabs */
            .tab-content { display: none !important; }
            .tab-content.active { display: block !important; }
            
            /* Layout adjustments */
            .header { 
                padding: 15px 20px; 
                background: #2E2E2E !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .container { padding: 15px; max-width: 100%; }
            body { 
                font-size: 11px; 
                background: white !important;
            }
            
            /* Section styling */
            .section { 
                break-inside: avoid; 
                margin-bottom: 15px; 
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            /* Table improvements */
            .table-container { 
                overflow: visible !important; 
            }
            table { 
                font-size: 10px; 
                width: 100%;
            }
            th, td { 
                padding: 4px 6px !important; 
            }
            
            /* Scorecards */
            .scorecards {
                display: flex !important;
                flex-wrap: wrap;
                gap: 10px;
            }
            .scorecard { 
                padding: 10px; 
                flex: 1;
                min-width: 120px;
                border: 1px solid #ddd;
                box-shadow: none;
            }
            
            /* Charts - hide as they don't print well */
            canvas { 
                max-height: 200px !important;
            }
            .chart-container {
                height: auto !important;
                max-height: 200px !important;
            }
            
            /* Grid layouts */
            .grid-2, .grid-3, .grid-4 {
                display: block !important;
            }
            .grid-2 > *, .grid-3 > *, .grid-4 > * {
                margin-bottom: 10px;
            }
            
            /* Colors for print */
            .badge {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .positive { color: #28a745 !important; }
            .negative { color: #dc3545 !important; }
            
            /* Page breaks */
            h3.section-title { 
                break-after: avoid; 
            }
            
            /* Hide slider values display */
            .slider-container { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <div class="logo">XYZ<span> </span>Distribution</div>
            <div class="header-subtitle">CEO Strategic Planning Portal • 2026</div>
        </div>
        <div class="header-right">
            <div id="save-indicator" style="font-size: 10px; opacity: 0.7; margin-bottom: 5px;">Auto-saved to browser</div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;">
                <button onclick="downloadBackup()" style="padding: 8px 14px; background: #f59e0b; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 11px;" title="Download your work as a backup file">
                    Download Backup
                </button>
                <button onclick="document.getElementById('restoreFile').click()" style="padding: 8px 14px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 11px;" title="Restore from a backup file">
                    Restore
                </button>
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreBackup(event)">
                <button onclick="exportToExcel()" style="padding: 8px 14px; background: var(--positive); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 11px;" title="Export all data to Excel spreadsheet">
                    Export Excel
                </button>
                <button onclick="generateFullReport()" style="padding: 8px 14px; background: var(--brand-blue); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 11px;" title="Generate printable PDF report">
                    Full Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showTab('guide')">How to Use</div>
        <div class="nav-tab" onclick="showTab('summary')">1. Executive Summary</div>
        <div class="nav-tab" onclick="showTab('layers')">2. Growth Layers</div>
        <div class="nav-tab" onclick="showTab('targets')">3. Dealer x Supplier Targets</div>
        <div class="nav-tab" onclick="showTab('regional')">4. Regional View</div>
        <div class="nav-tab" onclick="showTab('suppliers')">5. Supplier Analysis</div>
        <div class="nav-tab" onclick="showTab('pl')">6. P&L Calculator</div>
        <div class="nav-tab" onclick="showTab('salespeople')">7. Salesperson Targets</div>
    </div>
    
    <div class="container">
        <!-- TAB 0: HOW TO USE GUIDE -->
        <div id="guide" class="tab-content active">
            <div class="section" style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);">
                <h3 class="section-title">Strategic Planning Guide</h3>
                
                <!-- Required Reading Box -->
                <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 25px; border-radius: 10px; margin-bottom: 30px; color: white;">
                    <h4 style="margin: 0 0 15px 0; color: #fff; display: flex; align-items: center; gap: 10px;">
                        Required Reading Before Planning
                    </h4>
                    <p style="margin: 0 0 15px 0; font-size: 13px; opacity: 0.9;">
                        Before using this planning tool, please review these 4 analysis reports to understand the 2025 performance context:
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <a href="XYZ_EXECUTIVE_SUMMARY.html" target="_blank" style="background: rgba(255,255,255,0.1); padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <span style="font-size: 16px; font-weight: 700; color: var(--brand-blue);">1</span>
                            <div>
                                <div style="font-weight: 600; font-size: 12px;">XYZ_EXECUTIVE_SUMMARY.html</div>
                                <div style="font-size: 10px; opacity: 0.7;">Overall 2025 performance overview</div>
                            </div>
                        </a>
                        <a href="XYZ_DEALER_ANALYSIS.html" target="_blank" style="background: rgba(255,255,255,0.1); padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <span style="font-size: 16px; font-weight: 700; color: var(--brand-blue);">2</span>
                            <div>
                                <div style="font-weight: 600; font-size: 12px;">XYZ_DEALER_ANALYSIS.html</div>
                                <div style="font-size: 10px; opacity: 0.7;">Dealer-by-dealer performance breakdown</div>
                            </div>
                        </a>
                        <a href="XYZ_SUPPLIER_ANALYSIS.html" target="_blank" style="background: rgba(255,255,255,0.1); padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <span style="font-size: 16px; font-weight: 700; color: var(--brand-blue);">3</span>
                            <div>
                                <div style="font-weight: 600; font-size: 12px;">XYZ_SUPPLIER_ANALYSIS.html</div>
                                <div style="font-size: 10px; opacity: 0.7;">Supplier trends & classifications</div>
                            </div>
                        </a>
                        <a href="XYZ_FIELD_SALES_ANALYSIS.html" target="_blank" style="background: rgba(255,255,255,0.1); padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <span style="font-size: 16px; font-weight: 700; color: var(--brand-blue);">4</span>
                            <div>
                                <div style="font-weight: 600; font-size: 12px;">XYZ_FIELD_SALES_ANALYSIS.html</div>
                                <div style="font-size: 10px; opacity: 0.7;">Field sales team performance</div>
                            </div>
                        </a>
                    </div>
                    <p style="margin: 15px 0 0 0; font-size: 11px; opacity: 0.7; font-style: italic;">
                        Note: These files are included in the same folder as this planning tool.
                    </p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h4 style="margin-bottom: 10px; color: #856404;">Before You Start</h4>
                        <p style="margin: 0; font-size: 13px; color: #856404;">
                            <strong>Read the Executive Summary first</strong> to understand the current situation. 
                            The 2025 data shows a -7% decline, with 84% of the loss coming from Non-Dealers. 
                            Understanding this context is critical before setting 2026 targets.
                        </p>
                    </div>
                    <div style="background: #d1ecf1; padding: 20px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <h4 style="margin-bottom: 10px; color: #0c5460;">Your Work is Saved</h4>
                        <p style="margin: 0; font-size: 13px; color: #0c5460;">
                            All changes you make are <strong>automatically saved</strong> in your browser. 
                            You can close this page and return later - your targets will be preserved.
                            Use the Export/Import buttons to backup or share your work.
                        </p>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 20px; color: var(--brand-dark);">Recommended Planning Flow</h4>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid var(--brand-blue); position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: var(--brand-blue); color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 1</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Executive Summary</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Review 2025 performance, understand what drove the decline, and see where dealers vs non-dealers contributed.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--brand-blue);">▸ READ ONLY - No decisions yet</div>
                    </div>
                    
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid var(--brand-red); position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: var(--brand-red); color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 2</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Growth Layers</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Set your top-down growth expectation. Use sliders to allocate growth between New Products, Dealer Incentives, Field Sales, and Promotions.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--brand-red);">▸ DECISION - Set overall growth ambition</div>
                    </div>
                    
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid var(--positive); position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: var(--positive); color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 3</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Dealer x Supplier Targets</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Set specific targets for each Dealer × Supplier combination. Grey numbers show 2025 baseline, input boxes are your 2026 targets.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--positive);">▸ DECISION - Detailed target allocation</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid #6c757d; position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: #6c757d; color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 4</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Regional View</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Validate targets against geographic distribution. See penetration index to identify under/over-served regions.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: #6c757d;">▸ VALIDATION - Check regional balance</div>
                    </div>
                    
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid #6c757d; position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: #6c757d; color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 5</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Supplier Analysis</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Compare your targets vs strategic recommendations. Classifications suggest growth based on Unit and Price/Unit trends.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: #6c757d;">▸ VALIDATION - Check supplier alignment</div>
                    </div>
                    
                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid var(--purple); position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: var(--purple); color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 6</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">P&L Calculator</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            See the profit impact of your targets. Adjust COGS and operating costs to calculate expected margins.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--purple);">▸ VALIDATION - Profit viability</div>
                    </div>

                    <div class="flow-step" style="flex: 1; min-width: 200px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-top: 4px solid #f57c00; position: relative;">
                        <div style="position: absolute; top: -12px; left: 20px; background: #f57c00; color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;">STEP 7</div>
                        <h5 style="margin: 10px 0 8px 0; color: var(--brand-dark);">Salesperson Targets</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin: 0;">
                            Allocate field sales targets to individual salespeople. Set goals based on their regional coverage and capacity.
                        </p>
                        <div style="margin-top: 10px; font-size: 11px; color: #f57c00;">▸ FINAL STEP - Assign individual targets</div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid var(--positive);">
                    <h4 style="margin-bottom: 15px; color: #2e7d32;">Iterative Process</h4>
                    <p style="font-size: 13px; color: #2e7d32; margin: 0;">
                        <strong>This is not a one-way flow.</strong> After reviewing Regional, Supplier, or P&L views, you may need to go back to 
                        Growth Layers or Dealer x Supplier Targets to adjust. The goal is to find a balanced plan that is:
                    </p>
                    <ul style="margin: 10px 0 0 20px; font-size: 12px; color: #2e7d32;">
                        <li>Ambitious but achievable</li>
                        <li>Balanced across regions and suppliers</li>
                        <li>Aligned with strategic supplier classifications</li>
                        <li>Profitable at the P&L level</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Understanding the Data</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px; color: var(--brand-dark);">Dealer x Supplier Targets</h5>
                        <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span style="color: #999;">Grey numbers</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">2025 Baseline (actual sales)</td></tr>
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span style="padding: 2px 5px; background: #fff; border: 1px solid #ddd; border-radius: 3px;">Input boxes</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Your 2026 Target (editable)</td></tr>
                            <tr><td style="padding: 5px;"><span style="color: var(--positive);">Green totals</span></td><td style="padding: 5px;">Growth vs baseline</td></tr>
                        </table>
                    </div>
                    
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px; color: var(--brand-dark);">Supplier Classifications</h5>
                        <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span class="badge badge-green" style="font-size: 10px;">DOUBLE WIN</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Units ↑ Price ↑ → Push +15%</td></tr>
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span class="badge badge-blue" style="font-size: 10px;">VOLUME LED</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Units ↑ Price flat → +12%</td></tr>
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span class="badge badge-warning" style="font-size: 10px;">PRICE COLLAPSE</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Price ↓↓ → Recover pricing +10%</td></tr>
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span class="badge badge-red" style="font-size: 10px;">VOLUME COLLAPSE</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Units ↓↓ → Stabilize +5%</td></tr>
                            <tr><td style="padding: 5px;"><span class="badge badge-purple" style="font-size: 10px;">STABLE</span></td><td style="padding: 5px;">Both flat → Steady +8%</td></tr>
                        </table>
                    </div>
                    
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px; color: var(--brand-dark);">Regional Penetration Index</h5>
                        <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
                            Formula: <code style="background: #e9ecef; padding: 2px 5px; border-radius: 3px;">(% XYZ Distribution Sales) ÷ (% Market Customers)</code>
                        </p>
                        <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span style="color: var(--brand-blue);">Index &lt; 0.8</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">High Growth Potential</td></tr>
                            <tr><td style="padding: 5px; border-bottom: 1px solid #ddd;"><span style="color: var(--positive);">Index 0.8-1.2</span></td><td style="padding: 5px; border-bottom: 1px solid #ddd;">Balanced Coverage</td></tr>
                            <tr><td style="padding: 5px;"><span style="color: var(--warning);">Index &gt; 1.2</span></td><td style="padding: 5px;">Maxed Out Region</td></tr>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Save & Export</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button onclick="downloadBackup()" style="padding: 12px 25px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                        Download Backup
                    </button>
                    <button onclick="exportToExcel()" style="padding: 12px 25px; background: var(--positive); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                        Export to Excel
                    </button>
                    <button onclick="generateFullReport()" style="padding: 12px 25px; background: var(--brand-blue); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                        Full Report (PDF)
                    </button>
                    <button onclick="resetAllData()" style="padding: 12px 25px; background: var(--negative); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                        Reset to Defaults
                    </button>
                </div>
                <p style="margin-top: 15px; font-size: 12px; color: var(--text-muted);">
                    <strong>Auto-save is ON:</strong> Your changes are saved automatically as you edit.<br>
                    <strong>Download Backup:</strong> Saves a file you can restore later if browser data is cleared.<br>
                    <strong>Export to Excel:</strong> Creates a spreadsheet you can print, share, or edit.<br>
                    <strong>Full Report:</strong> Opens a comprehensive PDF-ready report with all your targets.
                </p>
            </div>
            
            <div style="text-align: center; padding: 30px 0;">
                <button onclick="showTab('summary'); document.querySelector('.nav-tab:nth-child(2)').click();" style="padding: 15px 40px; background: var(--brand-red); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">
                    Start with Executive Summary →
                </button>
            </div>
        </div>
        
        <!-- TAB 1: EXECUTIVE SUMMARY -->
        <div id="summary" class="tab-content">
            <!-- Data Period Note -->
            <div style="text-align: center; margin-bottom: 15px; font-size: 11px; color: var(--text-muted);">
                <strong>Data Period:</strong> Jan-Nov 2025 Actuals | YoY = Jan-Nov 2024 vs 2025 | Full Year = Estimate with Dec projection
            </div>
            <!-- December Projection Methodology Note -->
            <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 10px 15px; margin-bottom: 15px; font-size: 11px; color: #555;">
                <strong style="color: #333;">December Projection Method:</strong> 
                Full Year 2025 Estimate = Jan-Nov Actuals + December projection.
                December is projected based on historical seasonality where December is typically lower than November.
                <br><span style="color: #666;"><strong>Dealers:</strong> Dec 2025 = 85% of Nov 2025 sales</span>
                <br><span style="color: #666;"><strong>Non-Dealers:</strong> Dec 2025 = 70% of Nov 2025 sales</span>
                <br><span style="color: #888; font-style: italic;">Based on Dec/Nov ratio from 2024 historical data, per CEO guidance.</span>
            </div>
            <div class="scorecards">
                <div class="scorecard highlight">
                    <div class="scorecard-value">€5.76M</div>
                    <div class="scorecard-label">2025 Sales (Jan-Nov)</div>
                    <div class="scorecard-change negative">-5% vs 2024</div>
                </div>
                <div class="scorecard">
                    <div class="scorecard-value">€6.29M</div>
                    <div class="scorecard-label">2025 Full Year Est</div>
                    <div class="scorecard-change negative">-7% vs 2024</div>
                </div>
                <div class="scorecard highlight">
                    <div class="scorecard-value" id="scorecard-2026-target">€6.92M</div>
                    <div class="scorecard-label">2026 Target</div>
                    <div class="scorecard-change positive" id="scorecard-growth-pct">+10% Growth</div>
                </div>
                <div class="scorecard green">
                    <div class="scorecard-value">€10.68</div>
                    <div class="scorecard-label">Dealer €/Unit (2025)</div>
                    <div class="scorecard-change positive">+19% vs 2024</div>
                </div>
                <div class="scorecard warning">
                    <div class="scorecard-value">84%</div>
                    <div class="scorecard-label">Decline from Non-Dealers</div>
                    <div class="scorecard-change">€311K of €369K</div>
                </div>
            </div>
            
            <div class="strategic-box">
                <h3>The Real Story: Jan-Nov 2024 vs Jan-Nov 2025</h3>
                <table class="strategic-table">
                    <thead>
                        <tr>
                            <th>Channel</th>
                            <th class="text-right">2024 Sales</th>
                            <th class="text-right">2025 Sales</th>
                            <th class="text-right">Change</th>
                            <th class="text-right">% of Decline</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Dealers</strong></td>
                            <td class="text-right">€5,323,569</td>
                            <td class="text-right">€5,398,937</td>
                            <td class="text-right positive">+1%</td>
                            <td class="text-right">-</td>
                        </tr>
                        <tr>
                            <td><strong>Non-Dealers</strong></td>
                            <td class="text-right">€727,704</td>
                            <td class="text-right">€362,361</td>
                            <td class="text-right negative">-50%</td>
                            <td class="text-right negative">100%</td>
                        </tr>
                        <tr style="background: rgba(255,255,255,0.08);">
                            <td><strong>TOTAL</strong></td>
                            <td class="text-right"><strong>€6,051,273</strong></td>
                            <td class="text-right"><strong>€5,761,298</strong></td>
                            <td class="text-right negative">-5%</td>
                            <td class="text-right">100%</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="bottom-line">
                    <strong>Key Insight:</strong> Dealers are actually doing WELL! Sales +1% with +19% higher prices. <strong>Non-Dealers caused 84% of the decline</strong> - likely lost equipment deals (Supplier 4, Supplier 13, Supplier 12).
                </div>
            </div>
            
            <div class="grid-2">
                <div class="section">
                    <h3 class="section-title">Historical Trend</h3>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                <div class="section">
                    <h3 class="section-title">2026 Growth Target Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Key Highlights</h3>
                <div class="grid-3">
                    <div class="highlight-box">
                        <div class="highlight-header blue">Dealer Channel (94%)</div>
                        <div class="highlight-item"><strong>2025 YTD Performance:</strong></div>
                        <div class="highlight-item"><span class="tag tag-positive">+19%</span> Price per unit increase</div>
                        <div class="highlight-item"><span class="tag tag-positive">+1%</span> Sales (growing!)</div>
                        <div class="highlight-item" style="margin-top: 10px;"><strong>Top 3 (2025):</strong></div>
                        <div class="highlight-item">1. Dealer 1 (Region A) - €1.16M</div>
                        <div class="highlight-item">2. Dealer 2 - €831K</div>
                        <div class="highlight-item">3. Dealer 3 (Region C) - €705K</div>
                    </div>
                    
                    <div class="highlight-box">
                        <div class="highlight-header green">2026 Growth Target</div>
                        <div class="highlight-item"><strong>Total Target:</strong> <span id="summary-2026-target">€6.92M</span> (<span id="summary-growth-pct">+10%</span>)</div>
                        <div class="highlight-item"><strong>Growth Needed:</strong> <span id="summary-growth-amount">€629K</span></div>
                        <div class="highlight-item" style="margin-top: 10px;"><strong>Growth Sources (from Growth Layers):</strong></div>
                        <div class="highlight-item">• New Products: <span id="summary-layer1">€600K</span></div>
                        <div class="highlight-item">• Dealer Incentives: <span id="summary-layer2">€150K</span></div>
                        <div class="highlight-item">• Field Expansion: <span id="summary-layer3">€75K</span></div>
                        <div class="highlight-item">• Promotions: <span id="summary-layer4">€150K</span></div>
                    </div>
                    
                    <div class="highlight-box" style="background: #fff5f5;">
                        <div class="highlight-header red">Warning: Non-Dealer Alert</div>
                        <div class="highlight-item"><strong>84% of total decline</strong></div>
                        <div class="highlight-item"><span class="tag tag-negative">-50%</span> Sales (€728K to €363K)</div>
                        <div class="highlight-item"><span class="tag tag-negative">-38%</span> Price/Unit</div>
                        <div class="highlight-item" style="margin-top: 10px;"><strong>Likely Cause:</strong></div>
                        <div class="highlight-item">Lost high-ticket equipment deals</div>
                        <div class="highlight-item">Supplier 4, Supplier 13, Supplier 12 equipment</div>
                    </div>
                </div>
            </div>
            
            <!-- BOARD STRATEGY SUMMARY SECTIONS -->
            <div class="section">
                <h3 class="section-title" onclick="toggleSection('board-summary')" style="cursor: pointer;">
                    Board Executive Summary <span id="board-summary-toggle" style="float: right; font-weight: normal;">+</span>
                </h3>
                <div id="board-summary" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h4 style="margin: 0; color: var(--brand-dark);">XYZ Distribution Strategic Analysis</h4>
                        <p style="margin: 5px 0 0 0; color: var(--text-muted); font-size: 12px;">Board Strategy Meeting - 2026</p>
                    </div>
                    
                    <h4 style="margin: 20px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Headline Metrics (Jan-Nov Comparison)</h4>
                    <div class="table-container">
                        <table class="strategic-table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th class="text-right">2024</th>
                                    <th class="text-right">2025</th>
                                    <th class="text-right">Change</th>
                                    <th class="text-center">Assessment</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Revenue</td>
                                    <td class="text-right">EUR 6,051,273</td>
                                    <td class="text-right">EUR 5,761,298</td>
                                    <td class="text-right negative">-5%</td>
                                    <td class="text-center"><span class="badge badge-red">DECLINING</span></td>
                                </tr>
                                <tr>
                                    <td>Total Volume (Units)</td>
                                    <td class="text-right">581,963</td>
                                    <td class="text-right">487,250</td>
                                    <td class="text-right negative">-16%</td>
                                    <td class="text-center"><span class="badge badge-red">ALERT</span></td>
                                </tr>
                                <tr>
                                    <td>Avg Price per Unit</td>
                                    <td class="text-right">EUR 10.40</td>
                                    <td class="text-right">EUR 11.82</td>
                                    <td class="text-right positive">+14%</td>
                                    <td class="text-center"><span class="badge badge-warning">COMPENSATING</span></td>
                                </tr>
                                <tr>
                                    <td>Dealer Channel</td>
                                    <td class="text-right">EUR 5,323,569</td>
                                    <td class="text-right">EUR 5,398,937</td>
                                    <td class="text-right positive">+1%</td>
                                    <td class="text-center"><span class="badge badge-purple">FLAT</span></td>
                                </tr>
                                <tr>
                                    <td>Non-Dealer Channel</td>
                                    <td class="text-right">EUR 727,704</td>
                                    <td class="text-right">EUR 362,361</td>
                                    <td class="text-right negative">-50%</td>
                                    <td class="text-center"><span class="badge badge-red">COLLAPSED</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 style="margin: 30px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Price Tier Breakdown: Where Did Volume Go?</h4>
                    <div class="table-container">
                        <table class="strategic-table">
                            <thead>
                                <tr>
                                    <th>Price Tier</th>
                                    <th>Definition</th>
                                    <th class="text-right">2024 Volume</th>
                                    <th class="text-right">2025 Volume</th>
                                    <th class="text-right">Volume Change</th>
                                    <th class="text-right">Value Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Budget</strong></td>
                                    <td>EUR 0-4.50</td>
                                    <td class="text-right">399,271</td>
                                    <td class="text-right">301,616</td>
                                    <td class="text-right negative">-24%</td>
                                    <td class="text-right negative">-17%</td>
                                </tr>
                                <tr>
                                    <td><strong>Standard</strong></td>
                                    <td>EUR 4.50-15</td>
                                    <td class="text-right">92,416</td>
                                    <td class="text-right">95,367</td>
                                    <td class="text-right positive">+3%</td>
                                    <td class="text-right positive">+1%</td>
                                </tr>
                                <tr>
                                    <td><strong>Premium</strong></td>
                                    <td>EUR 15-75</td>
                                    <td class="text-right">93,343</td>
                                    <td class="text-right">91,033</td>
                                    <td class="text-right negative">-2%</td>
                                    <td class="text-right positive">+2%</td>
                                </tr>
                                <tr>
                                    <td><strong>High-Value</strong></td>
                                    <td>EUR 75+</td>
                                    <td class="text-right">6,105</td>
                                    <td class="text-right">5,897</td>
                                    <td class="text-right negative">-3%</td>
                                    <td class="text-right negative">-9%</td>
                                </tr>
                                <tr style="background: rgba(0,0,0,0.05);">
                                    <td><strong>TOTAL</strong></td>
                                    <td></td>
                                    <td class="text-right"><strong>581,963</strong></td>
                                    <td class="text-right"><strong>487,250</strong></td>
                                    <td class="text-right negative"><strong>-16%</strong></td>
                                    <td class="text-right negative"><strong>-5%</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 style="margin: 30px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Sales Value by Price Tier: Where Did Revenue Come From?</h4>
                    <div class="table-container">
                        <table class="strategic-table">
                            <thead>
                                <tr>
                                    <th>Price Tier</th>
                                    <th>Definition</th>
                                    <th class="text-right">2024 Sales (EUR)</th>
                                    <th class="text-right">2025 Sales (EUR)</th>
                                    <th class="text-right">Value Change</th>
                                    <th class="text-right">% of 2024</th>
                                    <th class="text-right">% of 2025</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Budget</strong></td>
                                    <td>EUR 0-4.50</td>
                                    <td class="text-right">277,181</td>
                                    <td class="text-right">228,876</td>
                                    <td class="text-right negative">-17%</td>
                                    <td class="text-right">6.5%</td>
                                    <td class="text-right">5.6%</td>
                                </tr>
                                <tr>
                                    <td><strong>Standard</strong></td>
                                    <td>EUR 4.50-15</td>
                                    <td class="text-right">519,016</td>
                                    <td class="text-right">525,426</td>
                                    <td class="text-right positive">+1%</td>
                                    <td class="text-right">12.2%</td>
                                    <td class="text-right">12.8%</td>
                                </tr>
                                <tr>
                                    <td><strong>Premium</strong></td>
                                    <td>EUR 15-75</td>
                                    <td class="text-right">1,856,798</td>
                                    <td class="text-right">1,895,184</td>
                                    <td class="text-right positive">+2%</td>
                                    <td class="text-right">43.7%</td>
                                    <td class="text-right">46.2%</td>
                                </tr>
                                <tr>
                                    <td><strong>High-Value</strong></td>
                                    <td>EUR 75+</td>
                                    <td class="text-right">1,591,573</td>
                                    <td class="text-right">1,450,307</td>
                                    <td class="text-right negative">-9%</td>
                                    <td class="text-right">37.5%</td>
                                    <td class="text-right">35.4%</td>
                                </tr>
                                <tr style="background: rgba(0,0,0,0.05);">
                                    <td><strong>TOTAL</strong></td>
                                    <td></td>
                                    <td class="text-right"><strong>4,244,568</strong></td>
                                    <td class="text-right"><strong>4,099,793</strong></td>
                                    <td class="text-right negative"><strong>-3%</strong></td>
                                    <td class="text-right">100%</td>
                                    <td class="text-right">100%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="note" style="background: #e8f5e9; border-left-color: var(--positive); margin: 20px 0;">
                        <strong>KEY INSIGHT:</strong> Budget tier = 61% of VOLUME but only 6% of REVENUE.<br>
                        Premium + High-Value = 20% of volume but 81% of revenue. <strong>This is where the money is.</strong>
                    </div>
                    
                    <h4 style="margin: 30px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Key Strategic Findings</h4>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">1. BUDGET TIER VOLUME COLLAPSED BUT LIMITED REVENUE IMPACT:</strong>
                            <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>Volume down 24% (97,655 fewer units) - this is where the volume loss happened</li>
                                <li>BUT Budget tier only contributes 6% of total revenue</li>
                                <li>Revenue impact: -EUR 72K (from EUR 416K to EUR 344K)</li>
                            </ul>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">2. PREMIUM TIER IS THE REVENUE ENGINE - AND IT GREW:</strong>
                            <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>Premium tier (EUR 15-75) contributes 46% of total revenue</li>
                                <li>Value grew +2% (EUR 2.79M to EUR 2.85M) despite -2% volume decline</li>
                                <li>This shows PRICING POWER in the core revenue segment</li>
                            </ul>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                            <strong style="color: var(--brand-dark);">3. HIGH-VALUE TIER DECLINED - THIS MATTERS:</strong>
                            <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>High-Value (EUR 75+) contributes 35% of revenue</li>
                                <li>Value dropped -9% (EUR 2.39M to EUR 2.18M) = -EUR 212K loss</li>
                                <li>Combined with Non-Dealer collapse, suggests equipment/big-ticket slowdown</li>
                            </ul>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <strong style="color: var(--brand-dark);">4. NET REVENUE CONTRIBUTION EFFECT:</strong>
                            <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>Premium growth: +EUR 57K | High-Value decline: -EUR 212K</li>
                                <li>Budget decline: -EUR 72K | Standard growth: +EUR 9K</li>
                                <li>Total revenue change: -EUR 218K (-3%)</li>
                            </ul>
                        </div>
                        
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                            <strong style="color: var(--brand-dark);">5. THE REAL CONCERN - CUSTOMER RELATIONSHIP RISK:</strong>
                            <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>Losing budget tier sales may not hurt revenue much today</li>
                                <li>BUT these everyday purchases keep customers coming back regularly</li>
                                <li><strong style="color: var(--negative);">Risk: If they buy consumables elsewhere, they may buy everything elsewhere</strong></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: right; font-size: 11px; color: var(--text-muted);">
                        Prepared by: Strategy Team | 2026
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title" onclick="toggleSection('numbers-meaning')" style="cursor: pointer;">
                    What The Numbers Mean <span id="numbers-meaning-toggle" style="float: right; font-weight: normal;">+</span>
                </h3>
                <div id="numbers-meaning" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="margin: 0; color: var(--text-muted); font-size: 12px;">Simple Explanation of the 2025 vs 2024 Analysis</p>
                    </div>
                    
                    <h4 style="margin: 20px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">The Story in Simple Terms</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0 0 10px 0;"><strong>What happened:</strong> XYZ Distribution sold 16% fewer products in 2025 compared to 2024 (Jan-Nov).</p>
                            <p style="margin: 0 0 10px 0;"><strong>But here's the twist:</strong> Revenue only dropped 5%, not 16%.</p>
                            <p style="margin: 0 0 10px 0;"><strong>Why?</strong> Because the average price per item sold increased by 14%.</p>
                            <p style="margin: 0; font-weight: 600; color: var(--brand-dark);"><strong>In other words:</strong> We're selling LESS stuff, but MORE EXPENSIVE stuff.</p>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">Why This Matters</h4>
                    
                    <p style="margin-bottom: 15px;">There are two ways a business can grow revenue:</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--positive);">1. HEALTHY GROWTH:</strong>
                            <p style="margin: 10px 0 5px 0;">Sell MORE products to MORE customers</p>
                            <ul style="margin: 0 0 0 20px; color: var(--text-muted); line-height: 1.6;">
                                <li>Volume goes UP, revenue goes UP</li>
                                <li>This is sustainable and shows market strength</li>
                            </ul>
                        </div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <strong style="color: #856404;">2. COMPENSATING FOR DECLINE:</strong>
                            <p style="margin: 10px 0 5px 0;">Sell FEWER products at HIGHER prices</p>
                            <ul style="margin: 0 0 0 20px; color: var(--text-muted); line-height: 1.6;">
                                <li>Volume goes DOWN, but revenue stays flat</li>
                                <li>This can work short-term but is NOT sustainable long-term</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="note" style="background: #fff5f5; border-left-color: var(--negative); margin: 20px 0;">
                        <strong>XYZ Distribution is currently in scenario #2.</strong>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">Think of it Like a Restaurant</h4>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                            <li>If you serve 100 meals at EUR 15 each = EUR 1,500 revenue</li>
                            <li>Next year you serve 84 meals at EUR 18 each = EUR 1,512 revenue</li>
                            <li>Revenue looks OK, but you're serving <strong>16% fewer customers!</strong></li>
                            <li style="color: var(--negative);"><strong>Eventually, competitors will take those customers permanently.</strong></li>
                        </ul>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">The Budget Tier Collapse - And Why It May Not Be As Bad As It Looks</h4>
                    
                    <p style="margin-bottom: 15px;"><strong>Where did the volume loss come from?</strong> We analysed products by price tier:</p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>BUDGET (EUR 0-4.50):</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><span class="negative">Volume DOWN 24%</span> = 97,655 fewer units</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>STANDARD (EUR 4.50-15):</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><span class="positive">Volume UP 3%</span></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>PREMIUM (EUR 15-75):</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><span class="negative">Volume DOWN 2%</span></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;"><strong>HIGH-VALUE (EUR 75+):</strong></td>
                                <td style="padding: 8px; text-align: right;"><span class="negative">Volume DOWN 3%</span></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="note" style="background: #e8f5e9; border-left-color: var(--positive); margin: 20px 0;">
                        <strong>BUT HERE'S THE KEY INSIGHT:</strong><br>
                        Budget tier = 61% of VOLUME but only 6% of REVENUE<br>
                        Premium + High-Value = 20% of volume but 81% of REVENUE<br><br>
                        <strong>So the volume collapse happened in low-revenue products!</strong>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">Revenue Impact by Tier</h4>
                    
                    <div style="display: grid; gap: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; padding: 10px 15px; background: #f8f9fa; border-radius: 6px;">
                            <span>Budget tier revenue loss:</span>
                            <span class="negative">-EUR 72K (small impact)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 15px; background: #f8f9fa; border-radius: 6px;">
                            <span>Standard tier revenue change:</span>
                            <span class="positive">+EUR 9K (slight gain)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 15px; background: #e8f5e9; border-radius: 6px;">
                            <span>Premium tier revenue change:</span>
                            <span class="positive"><strong>+EUR 57K (GOOD - this is 46% of revenue)</strong></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 15px; background: #fff5f5; border-radius: 6px;">
                            <span>High-Value tier revenue loss:</span>
                            <span class="negative"><strong>-EUR 212K (THIS is the real concern)</strong></span>
                        </div>
                    </div>
                    
                    <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                        <strong style="color: var(--negative);">THE REAL CONCERN IS NOT BUDGET - IT'S HIGH-VALUE:</strong>
                        <ul style="margin: 10px 0 0 20px; color: var(--text-muted); line-height: 1.8;">
                                <li>The High-Value tier (EUR 75+ products) dropped -9%</li>
                                <li>This represents -EUR 212K of the total -EUR 218K decline</li>
                            <li>Combined with Non-Dealer channel collapse (-50%), suggests equipment slowdown</li>
                        </ul>
                    </div>
                    
                    <div class="note" style="background: #fff3cd; border-left-color: var(--warning); margin: 20px 0;">
                        <strong>BUT BUDGET VOLUME STILL MATTERS FOR RELATIONSHIPS:</strong>
                        <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                            <li>Budget products are everyday consumables</li>
                            <li>They bring customers back frequently to dealers</li>
                            <li>If customers buy consumables elsewhere, they may buy everything elsewhere</li>
                            <li><strong>So volume loss = customer relationship risk, even if revenue impact is small</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title" onclick="toggleSection('know-vs-dont')" style="cursor: pointer;">
                    What We Know vs What We Don't Know <span id="know-vs-dont-toggle" style="float: right; font-weight: normal;">+</span>
                </h3>
                <div id="know-vs-dont" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="margin: 0; color: var(--text-muted); font-size: 12px;">What the data tells us - and what it doesn't</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                        <div>
                            <h4 style="margin: 0 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--positive); color: var(--positive);">What We KNOW (from the data)</h4>
                            <div style="display: grid; gap: 10px;">
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">1.</span>
                                    <span>XYZ Distribution's sell-in volume to dealers dropped 16% (comparing Jan-Nov 2024 to Jan-Nov 2025)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">2.</span>
                                    <span>Average transaction value increased 21% (from EUR 9.18 to EUR 11.12 per unit)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">3.</span>
                                    <span>Dealer channel revenue stayed essentially flat (+1%) despite -16% volume decline</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">4.</span>
                                    <span>Non-dealer channel revenue collapsed (-50%) - EUR 728K down to EUR 363K</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">5.</span>
                                    <span>Budget tier (EUR 0-4.50) = 61% of volume but only 6% of revenue (volume loss here has limited revenue impact)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">6.</span>
                                    <span>Premium tier (EUR 15-75) = 46% of revenue and GREW +2% (the revenue engine is healthy)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">7.</span>
                                    <span>High-Value tier (EUR 75+) declined -9% = -EUR 212K (this is where the real revenue loss occurred)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--positive);">8.</span>
                                    <span>Net revenue change: -EUR 218K (-3%) - mostly from High-Value decline</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin: 0 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--negative); color: var(--negative);">What We DON'T KNOW (data gaps)</h4>
                            <div style="display: grid; gap: 10px;">
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>How many customers each of the 14 dealers sold to (sell-through data)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>Whether dealers are holding more or less inventory (destocking vs restocking cycles)</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>Whether dealers switched some purchases to competitor suppliers</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>Whether the overall industry market contracted</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>Whether the same customers are buying less, or fewer customers are buying at all</span>
                                </div>
                                <div style="display: flex; gap: 10px; padding: 10px; background: #fff5f5; border-radius: 6px;">
                                    <span style="font-weight: 700; color: var(--negative);">?</span>
                                    <span>Why the non-dealer channel collapsed by 50%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">What The Volume Decline Could Mean</h4>
                    
                    <div class="table-container">
                        <table class="strategic-table">
                            <thead>
                                <tr>
                                    <th>Possible Explanation</th>
                                    <th>What It Would Mean for XYZ Distribution</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Dealers are selling to fewer customers</td>
                                    <td><span class="negative">Market share loss at dealer level - concerning</span></td>
                                </tr>
                                <tr>
                                    <td>Same customers are buying less frequently</td>
                                    <td>Demand or consumption decline in the market</td>
                                </tr>
                                <tr>
                                    <td>Dealers are destocking inventory</td>
                                    <td><span class="positive">Temporary effect - should reverse in coming months</span></td>
                                </tr>
                                <tr>
                                    <td>Dealers are sourcing from competitor suppliers</td>
                                    <td><span class="negative"><strong>XYZ Distribution losing share with its own dealers - very concerning</strong></span></td>
                                </tr>
                                <tr>
                                    <td>Overall market contraction</td>
                                    <td>Industry-wide issue - not unique to XYZ Distribution</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-blue);">Recommendation to Close the Data Gap</h4>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                        <p style="margin: 0 0 15px 0;">
                            Without sell-through data (what dealers actually sold to customers), we cannot determine whether the volume decline is:
                        </p>
                        <ul style="margin: 0 0 15px 20px; line-height: 1.8;">
                            <li><strong>a) A market share problem</strong> (customers buying from competitors)</li>
                            <li><strong>b) A market size problem</strong> (overall demand declining)</li>
                            <li><strong>c) A timing problem</strong> (dealer inventory cycles)</li>
                        </ul>
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 15px;">
                            <strong style="color: var(--brand-blue);">ACTION:</strong> Request sell-through reports from key dealers to understand the true picture.<br><br>
                            <span style="color: var(--text-muted); font-style: italic;">Even partial data from the top 3-5 dealers would provide valuable insight.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title" onclick="toggleSection('questions-discussion')" style="cursor: pointer;">
                    Questions for Board Discussion <span id="questions-discussion-toggle" style="float: right; font-weight: normal;">+</span>
                </h3>
                <div id="questions-discussion" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="margin: 0; color: var(--text-muted); font-size: 12px;">Strategic questions to consider based on the analysis findings</p>
                    </div>
                    
                    <h4 style="margin: 20px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Understanding the Volume Decline</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">Q1: Do we have visibility into dealer inventory levels?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">If dealers are holding less stock, the decline may be temporary. If not, it's a demand issue.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">Q2: Have any dealers reported losing end customers to competitors?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Direct feedback from dealers would clarify if this is a market share problem.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">Q3: Is the budget tier decline happening across all dealers, or concentrated in specific ones?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Concentrated decline might indicate dealer-specific issues vs. market-wide trends.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">Q4: What are competitors doing in the budget consumables segment?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Are they running promotions, offering better terms, or expanding distribution?</p>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Strategic Direction</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">Q5: Is the shift to premium/higher-priced products an intentional strategy?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">If yes, the volume decline in budget may be acceptable. If no, it's a warning sign.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">Q6: Should we invest in getting sell-through data from dealers?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">This would close the biggest data gap and enable better strategic decisions.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">Q7: What is our plan to recover volume in the budget tier?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Options: pricing actions, promotions, dealer incentives, new products, etc.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">Q8: Are we at risk of losing the 'everyday relationship' with customers?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">If they buy consumables elsewhere, they may eventually buy everything elsewhere.</p>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Non-Dealer Channel Collapse</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                            <strong style="color: var(--brand-dark);">Q9: What caused the 50% collapse in non-dealer channel revenue?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">This channel typically handles equipment/high-value items - what changed?</p>
                        </div>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                            <strong style="color: var(--brand-dark);">Q10: Were there specific large orders in 2024 that didn't repeat in 2025?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">One-off equipment purchases can skew year-over-year comparisons.</p>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">Revenue Contribution Analysis</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <strong style="color: var(--brand-dark);">Q-R1: Given Premium tier is 46% of revenue and grew +2%, should we focus on Premium growth rather than recovering Budget volume?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Budget recovery may not significantly impact revenue, but Premium growth would.</p>
                        </div>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--negative);">
                            <strong style="color: var(--brand-dark);">Q-R2: What caused the High-Value tier to decline -9% (-EUR 212K)? Is this related to the Non-Dealer channel collapse?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">This is where the real revenue loss occurred - need to understand root cause.</p>
                        </div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <strong style="color: var(--brand-dark);">Q-R3: Should we accept Budget tier volume decline if it means customers are buying consumables cheaper elsewhere?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Consider: Is it better to focus on high-margin products where we have pricing power?</p>
                        </div>
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--brand-blue);">
                            <strong style="color: var(--brand-dark);">Q-R4: Are we seeing a structural shift in the market towards Premium products?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">If yes, this could be an opportunity rather than a threat.</p>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid var(--brand-red);">2026 Planning</h4>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--purple);">
                            <strong style="color: var(--brand-dark);">Q11: What volume growth target should we set for 2026?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Given the -16% decline, should the priority be recovery or accepting a new baseline?</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--purple);">
                            <strong style="color: var(--brand-dark);">Q12: How will we track monthly progress against targets?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">Early warning system needed to identify issues before year-end.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--purple);">
                            <strong style="color: var(--brand-dark);">Q13: What new product lines could drive both volume and new customer acquisition?</strong>
                            <p style="margin: 10px 0 0 0; color: var(--text-muted);">New products can attract new customers and increase basket size with existing ones.</p>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- TAB 2: TARGET SETTING -->
        <div id="targets" class="tab-content">
            <div class="section">
                <h3 class="section-title">2026 Dealer x Supplier Target Matrix</h3>
                
                <div class="note" style="background: #e3f2fd; border-left-color: #1976d2; margin-bottom: 15px;">
                    <strong>Supplier Grouping Logic:</strong>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>24 Main Suppliers:</strong> Top 10 (ranked by 2025 sales) shown individually in matrix, remaining 14 aggregated as "Other Main"</li>
                        <li><strong>73 Other Suppliers:</strong> All aggregated as "Other Supp" in matrix</li>
                        <li><strong>2 New Suppliers:</strong> Not in datalist (new 2026 contracts with &euro;0 baseline)</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 20px; margin-bottom: 15px; padding: 12px 16px; background: linear-gradient(90deg, #f8f9fa 0%, #fff 100%); border-radius: 8px; border: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">2025 Baseline:</span>
                        <span style="font-size: 18px; font-weight: 700; color: var(--brand-dark);" id="matrix-baseline-display">€5.90M</span>
                    </div>
                    <div style="width: 1px; background: #ddd;"></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">2026 Target:</span>
                        <span style="font-size: 18px; font-weight: 700; color: var(--brand-red);" id="matrix-target-display">€6.50M</span>
                    </div>
                    <div style="width: 1px; background: #ddd;"></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Growth:</span>
                        <span style="font-size: 18px; font-weight: 700; color: var(--positive);" id="matrix-growth-display">+€593K (+10.0%)</span>
                    </div>
                </div>
                
                <div class="note">
                    <strong>Instructions:</strong> Edit the 2026 Target cells to set dealer × supplier targets. Totals update automatically. 
                    Target: Match the <strong>Growth Layers</strong> ambition (Layer 1 for new products is auto-distributed).
                </div>
                
                <div class="note" style="background: #fff8e6; border-left-color: #f59e0b;">
                    <strong>Tier Strategy:</strong> Tier 1 (>€1.5M cumulative) = 43.7% revenue, protect & optimize | Tier 2 (€800K-€1.5M) = 38.4%, address Dealer 5 decline | Tier 3 (<€800K) = 17.9%, develop rising stars (Dealer 10, Dealer 12)
                </div>
                
                <div class="note" style="background: #fff8e1; border-left-color: #b8860b;">
                    <strong>New Suppliers (Yellow Columns):</strong> 2025 baseline is €0K (no history - new products). 2026 targets are <strong>linked to Layer 1: New Products</strong> from the Growth Layers section - the Layer 1 value is split 50/50 between New Supplier 1 and New Supplier 2, distributed proportionally by each dealer's revenue share. Change Layer 1 to update these targets automatically.
                </div>
                
                <div class="table-container" style="max-height: 600px; overflow: auto;">
                    <table id="target-matrix">
                        <thead>
                            <tr>
                                <th style="position: sticky; left: 0; z-index: 20; min-width: 140px;">
                                    Dealer
                                    <div style="font-size: 9px; font-weight: 400; margin-top: 4px; opacity: 0.7; line-height: 1.3;">
                                        <span style="color: #999;">Grey = 2025</span><br>
                                        <span style="color: #fff;">Box = 2026</span>
                                    </div>
                                </th>
                                <th class="text-right">Supplier 1</th>
                                <th class="text-right">Supplier 2</th>
                                <th class="text-right">Supplier 3</th>
                                <th class="text-right">Supplier 5</th>
                                <th class="text-right">Supplier 6</th>
                                <th class="text-right">Supplier 7</th>
                                <th class="text-right">Supplier 8</th>
                                <th class="text-right">Supplier 9</th>
                                <th class="text-right">Supplier 10</th>
                                <th class="text-right">Supplier 4</th>
                                <th class="text-right" style="background: #b8860b; color: white;">Supplier 19</th>
                                <th class="text-right" style="background: #b8860b; color: white;">Supplier 20</th>
                                <th class="text-right" style="background: #3a3a3a;">Supplier 21</th>
                                <th class="text-right" style="background: #3a3a3a;">Supplier 22</th>
                                <th class="text-right" style="background: var(--brand-red);">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody id="target-matrix-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 15px;">
                    <button class="btn btn-primary" onclick="applyGrowthRate()">Apply +10% to All</button>
                    <button class="btn btn-secondary" onclick="resetTargets()">Reset to Baseline</button>
                    <button class="btn btn-secondary" onclick="exportTargets()">Export CSV</button>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="section">
                    <h3 class="section-title">2025 Baseline by Dealer (All 14)</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="baselineByDealerChart"></canvas>
                    </div>
                </div>
                <div class="section">
                    <h3 class="section-title">2025 Baseline by Supplier</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="baselineBySupplierChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="section">
                    <h3 class="section-title">2026 Growth by Dealer (All 14)</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="growthByDealerChart"></canvas>
                    </div>
                </div>
                <div class="section">
                    <h3 class="section-title">2026 Growth by Supplier</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="growthBySupplierChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB 3: REGIONAL VIEW -->
        <div id="regional" class="tab-content">
            <div class="section">
                <h3 class="section-title">Regional Market Analysis</h3>
                <div class="note">
                    <strong>Penetration Index</strong> = (% of XYZ Distribution Sales) ÷ (% of Market Customers). 
                    Index &gt;1.2 = Maxed Out, 0.8-1.2 = Balanced, &lt;0.8 = High Potential for growth.
                    Total market customers: 13,916 (domestic only). Total XYZ Distribution 2025: €4.19M.
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Region</th>
                                <th class="text-right">Customers</th>
                                <th class="text-right">% of Domestic Market</th>
                                <th>XYZ Distribution Dealers</th>
                                <th class="text-right">2025 Sales</th>
                                <th class="text-right">% of XYZ Distribution</th>
                                <th class="text-right">Penetration</th>
                                <th class="text-right">2026 Target</th>
                                <th class="text-center">Insight</th>
                            </tr>
                        </thead>
                        <tbody id="regional-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Growth Opportunity Insights</h3>
                <div class="grid-3" id="regional-insights">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Regional Summary</h3>
                <div class="grid-4" id="regional-cards">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
        
        <!-- TAB 4: GROWTH LAYERS -->
        <div id="layers" class="tab-content">
            <div class="section">
                <h3 class="section-title">Strategic Growth Layers - 2026 Target Assumptions vs Baseline (2025 full year actual estimated with Dec month projected)</h3>
                <div class="note">
                    Adjust these growth levers to set your 2026 ambition. Targets cascade down to the Dealer x Supplier Targets (tab 2) and Salesperson Targets (tab 6) allocation.
                </div>
                
                <!-- Waterfall Visualization -->
                <div class="waterfall-container">
                    <div class="waterfall-title">Top-Down Growth Waterfall</div>
                    <div class="waterfall-chart">
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" id="wf-baseline-val">€4.2M</div>
                            <div class="waterfall-bar-inner waterfall-baseline" id="wf-baseline" style="height: 140px;"></div>
                            <div class="waterfall-bar-label">2025<br>Baseline</div>
                        </div>
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" style="color: #00AEEF;" id="wf-l1-val">+€400K</div>
                            <div class="waterfall-bar-inner waterfall-layer1" id="wf-l1" style="height: 34px;"><div class="waterfall-connector"></div></div>
                            <div class="waterfall-bar-label">New<br>Products</div>
                        </div>
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" style="color: #28a745;" id="wf-l2-val">+€100K</div>
                            <div class="waterfall-bar-inner waterfall-layer2" id="wf-l2" style="height: 9px;"><div class="waterfall-connector"></div></div>
                            <div class="waterfall-bar-label">Dealer<br>Incentives</div>
                        </div>
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" style="color: #ffc107;" id="wf-l3-val">+€50K</div>
                            <div class="waterfall-bar-inner waterfall-layer3" id="wf-l3" style="height: 5px;"><div class="waterfall-connector"></div></div>
                            <div class="waterfall-bar-label">Field<br>Sales</div>
                        </div>
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" style="color: #6f42c1;" id="wf-l4-val">+€100K</div>
                            <div class="waterfall-bar-inner waterfall-layer4" id="wf-l4" style="height: 9px;"><div class="waterfall-connector"></div></div>
                            <div class="waterfall-bar-label">Promos</div>
                        </div>
                        <div class="waterfall-bar">
                            <div class="waterfall-bar-value" style="color: var(--brand-red);" id="wf-target-val">€4.7M</div>
                            <div class="waterfall-bar-inner waterfall-total" id="wf-target" style="height: 155px;"></div>
                            <div class="waterfall-bar-label">2026<br>Target</div>
                        </div>
                    </div>
                    
                    <!-- Percentage Breakdown Bar -->
                    <div class="growth-breakdown">
                        <div class="breakdown-title">Growth Contribution by Layer (% of Total Growth)</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-segment layer1" id="bd-l1" style="width: 62%;">62%</div>
                            <div class="breakdown-segment layer2" id="bd-l2" style="width: 15%;">15%</div>
                            <div class="breakdown-segment layer3" id="bd-l3" style="width: 8%;">8%</div>
                            <div class="breakdown-segment layer4" id="bd-l4" style="width: 15%;">15%</div>
                        </div>
                        <div class="breakdown-legend">
                            <div class="legend-item"><div class="legend-color" style="background: #00AEEF;"></div><span>New Products</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #28a745;"></div><span>Dealer Incentives</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #ffc107;"></div><span>Field Sales</span></div>
                            <div class="legend-item"><div class="legend-color" style="background: #6f42c1;"></div><span>Promotions</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="grid-4">
                    <div class="layer-card">
                        <div class="layer-name">Layer 1: New Products</div>
                        <div class="layer-value">€<span id="layer1-value">400</span>K</div>
                        <input type="range" class="layer-slider" id="layer1" min="0" max="500" value="400" oninput="updateLayers()">
                        <div class="layer-impact">
                            <span class="impact-amount" id="layer1-impact">€400K</span>
                            <span class="impact-share" id="layer1-share">62%</span>
                        </div>
                        <div class="layer-description">New supplier partnerships, product launches (e.g., 2 new brands at €200K each)</div>
                    </div>
                    <div class="layer-card">
                        <div class="layer-name">Layer 2: Dealer Incentives</div>
                        <div class="layer-value">€<span id="layer2-value">100</span>K</div>
                        <input type="range" class="layer-slider" id="layer2" min="0" max="400" value="100" oninput="updateLayers()">
                        <div class="layer-impact">
                            <span class="impact-amount" id="layer2-impact">€100K</span>
                            <span class="impact-share" id="layer2-share">15%</span>
                        </div>
                        <div class="layer-description">VIP programme, volume discounts, rebates to dealers (XYZ Distribution → Dealers)</div>
                    </div>
                    <div class="layer-card">
                        <div class="layer-name">Layer 3: Field Sales Expansion</div>
                        <div class="layer-value">€<span id="layer3-value">50</span>K</div>
                        <input type="range" class="layer-slider" id="layer3" min="0" max="500" value="50" oninput="updateLayers()">
                        <div class="layer-impact">
                            <span class="impact-amount" id="layer3-impact">€50K</span>
                            <span class="impact-share" id="layer3-share">8%</span>
                        </div>
                        <div class="layer-description">New sales person, stretched targets, bonus schemes for overachievement</div>
                    </div>
                    <div class="layer-card">
                        <div class="layer-name">Layer 4: Promotions</div>
                        <div class="layer-value">€<span id="layer4-value">100</span>K</div>
                        <input type="range" class="layer-slider" id="layer4" min="0" max="200" value="100" oninput="updateLayers()">
                        <div class="layer-impact">
                            <span class="impact-amount" id="layer4-impact">€100K</span>
                            <span class="impact-share" id="layer4-share">15%</span>
                        </div>
                        <div class="layer-description">Seasonal deals (Black Friday, Christmas, Summer), bundling offers, catalogue promotions</div>
                    </div>
                </div>
                
                <!-- STEPPED TARGET FLOW -->
                <div style="margin-top: 25px; display: flex; flex-direction: column; align-items: center;">
                    
                    <!-- STEP 1: Growth Target (Hero) -->
                    <div style="position: relative; width: 100%; max-width: 500px;">
                        <div style="position: absolute; top: 12px; left: -40px; width: 28px; height: 28px; background: var(--brand-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700;">1</div>
                        <div style="text-align: center; padding: 25px 30px; background: linear-gradient(135deg, #f0f7ff 0%, #e3f0ff 100%); border-radius: 12px; border: 2px solid var(--brand-blue);">
                            <div style="font-size: 12px; color: var(--brand-blue); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;">Your 2026 Growth Target</div>
                            <div style="font-size: 42px; font-weight: 700; color: var(--brand-blue);" id="total-layers-impact">+€476K</div>
                            <div style="font-size: 18px; font-weight: 600; color: var(--positive); margin-top: 4px;" id="total-layers-pct">+11.3% from baseline</div>
                            <div style="font-size: 14px; color: var(--text-muted); margin-top: 10px;">
                                Target: <strong id="total-2026-target" style="color: var(--brand-dark);">€4.67M</strong>
                            </div>
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 8px;">Set via Growth Layers above</div>
                        </div>
                    </div>
                    
                    <!-- Connector Line -->
                    <div style="width: 2px; height: 30px; background: linear-gradient(to bottom, var(--brand-blue), #ccc);"></div>
                    <div style="width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 10px solid #ccc;"></div>
                    
                    <!-- STEP 2: Allocation Methods -->
                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin: 15px 0 10px 0;">How targets are allocated</div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%;">
                        
                        <!-- Step 2A: Dealer x Supplier -->
                        <div style="position: relative;">
                            <div style="position: absolute; top: 12px; left: -12px; width: 24px; height: 24px; background: var(--brand-dark); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700;">2a</div>
                            <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; border: 1px solid #e0e0e0; height: 100%;">
                                <div style="font-size: 11px; color: var(--brand-dark); font-weight: 700; text-transform: uppercase; margin-bottom: 12px;">Dealer x Supplier Allocation</div>
                                <div style="font-size: 28px; font-weight: 700; color: var(--brand-dark);" id="matrix-total-2026">€4.33M</div>
                                <div style="font-size: 13px; color: var(--positive); font-weight: 600; margin-top: 4px;" id="matrix-total-growth">+€395K</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;" id="matrix-total-pct">+10.0% from baseline</div>
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed #ddd;">
                                    <div style="font-size: 10px; color: var(--text-muted);" id="dealer-gap-indicator"></div>
                                </div>
                                <div style="font-size: 10px; color: var(--brand-blue); margin-top: 8px; cursor: pointer;" onclick="showTab('targets');">Edit in Dealer x Supplier Targets tab ↗</div>
                            </div>
                        </div>
                        
                        <!-- Step 2B: Field Sales -->
                        <div style="position: relative;">
                            <div style="position: absolute; top: 12px; left: -12px; width: 24px; height: 24px; background: #f57c00; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700;">2b</div>
                            <div style="padding: 20px; background: #fffbf5; border-radius: 10px; border: 1px solid #ffe0b2; height: 100%;">
                                <div style="font-size: 11px; color: #f57c00; font-weight: 700; text-transform: uppercase; margin-bottom: 12px;">Field Sales Allocation</div>
                                <div style="font-size: 28px; font-weight: 700; color: #f57c00;" id="field-total-target">€0</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Sum of individual salesperson targets</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">(<span id="field-ratio-note">69.4</span>% of dealer revenue)</div>
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed #ddd;">
                                    <div style="font-size: 10px; color: var(--text-muted);" id="field-gap-indicator"></div>
                                </div>
                                <div style="font-size: 10px; color: #f57c00; margin-top: 8px; cursor: pointer;" onclick="showTab('salespeople');">Edit in Salesperson Targets tab ↗</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden elements for JS compatibility -->
                    <div id="variance-box" style="display: none;"></div>
                    <div id="variance-amount" style="display: none;"></div>
                    <div id="variance-message" style="display: none;"></div>
                    <div id="field-variance-box" style="display: none;"></div>
                    <div id="field-variance-amount" style="display: none;"></div>
                    <div id="field-variance-message" style="display: none;"></div>
                </div>
                
                <!-- STEP 3: Reconciliation Banner -->
                <div style="margin-top: 20px; padding: 14px 18px; background: #fff8f0; border-radius: 8px; border: 1px solid #ffcc80; font-size: 12px;" id="reconciliation-banner">
                    <div style="display: flex; align-items: flex-start; gap: 10px;">
                        <span style="font-size: 16px;">⚠️</span>
                        <div>
                            <strong style="color: #e65100;">Planning Check</strong>
                            <div style="margin-top: 4px; color: #555;" id="reconciliation-message">
                                Checking allocation gaps...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- TAB 5: SUPPLIER ANALYSIS -->
        <div id="suppliers" class="tab-content">
            <div class="section">
                <h3 class="section-title">Supplier Classification by Growth Source</h3>
                <div class="note">
                    Suppliers are classified based on their Units and Price/Unit trends to determine the right growth strategy.
                </div>
                
                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--positive); border-radius: 3px;"></span>
                        <strong>DOUBLE WIN</strong> - Units ↑ Price ↑ → Push both (+15%)
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--brand-blue); border-radius: 3px;"></span>
                        <strong>VOLUME LED</strong> - Units ↑ Price flat → Push volume (+12%)
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--warning); border-radius: 3px;"></span>
                        <strong>PRICE COLLAPSE</strong> - Units OK, Price ↓↓ → Recover pricing (+10%)
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--negative); border-radius: 3px;"></span>
                        <strong>VOLUME COLLAPSE</strong> - Units ↓↓ → Stabilize (+5%)
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                        <span style="width: 12px; height: 12px; background: var(--purple); border-radius: 3px;"></span>
                        <strong>STABLE</strong> - Both flat → Steady growth (+8%)
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Supplier</th>
                                <th class="text-right">2025 Baseline</th>
                                <th class="text-right">Growth %</th>
                                <th class="text-right">Units Chg</th>
                                <th class="text-right">Price/Unit Chg</th>
                                <th class="text-center">Classification</th>
                                <th class="text-right">2026 Target</th>
                            </tr>
                        </thead>
                        <tbody id="supplier-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Growth Source Breakdown</h3>
                <div class="chart-container" style="height: 280px;">
                    <canvas id="supplierClassChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- TAB 6: P&L CALCULATOR -->
        <div id="pl" class="tab-content">
            <div class="section">
                <h3 class="section-title">P&L Calculator</h3>
                <div class="note">
                    Enter cost assumptions to calculate estimated margins and profitability for 2026.
                </div>
                
                <div class="grid-2">
                    <div>
                        <h4 style="margin-bottom: 15px; color: var(--brand-dark);">Cost Inputs</h4>
                        
                        <div class="pl-input-group">
                            <label>2026 Revenue Target (€)</label>
                            <input type="number" id="pl-revenue" value="4613677" onchange="calculatePL()">
                        </div>
                        
                        <div class="pl-input-group">
                            <label>Cost of Goods Sold (%)</label>
                            <input type="number" id="pl-cogs" value="65" onchange="calculatePL()">
                        </div>
                        
                        <div class="pl-input-group">
                            <label>Operating Expenses (€)</label>
                            <input type="number" id="pl-opex" value="350000" onchange="calculatePL()">
                        </div>
                        
                        <div class="pl-input-group">
                            <label>Other Costs (€)</label>
                            <input type="number" id="pl-other" value="50000" onchange="calculatePL()">
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 15px; color: var(--brand-dark);">Results</h4>
                        
                        <div class="grid-2" style="gap: 15px;">
                            <div class="pl-result">
                                <div class="pl-result-value" id="pl-gross-margin">€1.61M</div>
                                <div class="pl-result-label">Gross Margin</div>
                            </div>
                            <div class="pl-result">
                                <div class="pl-result-value" id="pl-gross-pct">35%</div>
                                <div class="pl-result-label">Gross Margin %</div>
                            </div>
                            <div class="pl-result">
                                <div class="pl-result-value" id="pl-net-profit" style="color: var(--positive);">€1.21M</div>
                                <div class="pl-result-label">Net Profit</div>
                            </div>
                            <div class="pl-result">
                                <div class="pl-result-value" id="pl-net-pct" style="color: var(--positive);">26%</div>
                                <div class="pl-result-label">Net Margin %</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #f0f9f0; border-radius: 8px; border-left: 4px solid var(--positive);">
                            <div style="font-size: 12px; color: var(--text-muted);">Profit vs 2025 Est</div>
                            <div style="font-size: 18px; font-weight: 700; color: var(--positive);" id="pl-vs-2025">+€120K improvement</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">P&L Summary Table</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Line Item</th>
                                <th class="text-right">2025 Est</th>
                                <th class="text-right">2026 Target</th>
                                <th class="text-right">Change</th>
                            </tr>
                        </thead>
                        <tbody id="pl-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- TAB 7: SALESPERSON TARGETS -->
        <div id="salespeople" class="tab-content">
            <div class="section">
                <h3 class="section-title">Salesperson Targets - 2026 Cascade</h3>
                
                <!-- Field Sales Ratio Setting -->
                <div style="display: flex; gap: 20px; margin-bottom: 15px; padding: 15px; background: #fff8e1; border-radius: 8px; border: 2px solid #f57c00; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-size: 11px; font-weight: 700; color: #f57c00; margin-bottom: 4px;">FIELD SALES % OF DEALER REVENUE</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Set the expected share of field sales attribution to total dealer sales. This determines how dealer targets flow to field salespeople.</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="field-sales-ratio" value="69.4" min="0" max="100" step="0.1" 
                               style="width: 80px; padding: 8px; font-size: 18px; font-weight: 700; text-align: center; border: 2px solid #f57c00; border-radius: 4px; background: white;"
                               onchange="updateFieldSalesRatio(this.value)">
                        <span style="font-size: 18px; font-weight: 700; color: #f57c00;">%</span>
                    </div>
                </div>
                
                <!-- Summary: Field Rep Total vs Layer 3 -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div style="text-align: center; padding: 15px; background: #fff8e1; border-radius: 8px;">
                        <div style="font-size: 11px; color: #f57c00; font-weight: 700; margin-bottom: 4px;">TOTAL FIELD SALESPERSON TARGETS</div>
                        <div style="font-size: 9px; color: var(--text-muted); margin-bottom: 8px;">Sum of all salesperson targets (calculated or overridden)</div>
                        <div style="font-size: 28px; font-weight: 700; color: #f57c00;" id="total-field-rep-targets">€0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f0f7ff; border-radius: 8px;">
                        <div style="font-size: 11px; color: var(--brand-blue); font-weight: 700; margin-bottom: 4px;">EXPECTED FIELD SHARE</div>
                        <div style="font-size: 9px; color: var(--text-muted); margin-bottom: 8px;">Field Sales % x 2026 Strategic Target</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--brand-blue);" id="expected-field-share">€0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; border-radius: 8px;" id="field-rep-variance-box" style="background: #f8f9fa;">
                        <div style="font-size: 11px; color: var(--text-muted); font-weight: 700; margin-bottom: 4px;">VARIANCE</div>
                        <div style="font-size: 9px; color: var(--text-muted); margin-bottom: 8px;">Salesperson targets vs Expected Share</div>
                        <div style="font-size: 28px; font-weight: 700;" id="field-rep-variance">€0</div>
                    </div>
                </div>
                
                <div class="note">
                    <strong>Calculation:</strong> Field sales = <span id="field-ratio-display">69.4</span>% of dealer revenue. Each salesperson's 2026 target is based on their 2025 share of dealer's field sales, applied to dealer's 2026 target.
                    <br><strong>15 Active Salespeople</strong> | 2025 YTD (Jan-Oct): €2,178,491 | Annualized Est: €2,614,189
                    <br><em style="color: #f57c00;">Override individual targets by editing the orange input cells. Overridden cells turn orange.</em>
                </div>
                
                <div style="margin-bottom: 15px; padding: 12px; background: #f0f7ff; border-left: 4px solid var(--brand-blue); border-radius: 0 8px 8px 0; font-size: 11px;">
                    <strong>How Salesperson Targets are Calculated:</strong><br>
                    <span style="color: #555;">Dealer 2026 Target (from Dealer x Supplier Targets) x Field Sales % x Salesperson's % of Dealer = Calc. Target</span><br>
                    <span style="color: #888;">Example: €885K (Dealer) x 69.4% (Field) = €614K x 63.5% (Salesperson Share) = <strong>€393K</strong> calculated target</span>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Salesperson</th>
                                <th>Dealer</th>
                                <th class="text-right">2025 YTD (Oct)</th>
                                <th class="text-right">2025 Est (Ann.)</th>
                                <th class="text-right">% of Dealer</th>
                                <th class="text-right help-tip" data-tooltip="Total 2026 target for this dealer (from Dealer x Supplier Targets tab). Example: Dealer €885K x Field % 69.4% = €614K x Salesperson Share 63.5% = Calc €393K">Dealer 2026 Target</th>
                                <th class="text-right help-tip" data-tooltip="Calculated target = (Dealer Target x Field Sales %) x Salesperson's % of Dealer">Calc. Target</th>
                                <th class="text-right" style="background: #f57c00; color: white;">2026 Target (Edit)</th>
                                <th class="text-right">Growth %</th>
                            </tr>
                        </thead>
                        <tbody id="salespeople-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Methodology Note -->
                <div style="margin-top: 12px; padding: 10px 14px; background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 11px; color: #555;">
                    <strong style="color: #333;">Column Definitions:</strong>
                    <ul style="margin: 6px 0 0 0; padding-left: 18px; line-height: 1.6;">
                        <li><strong>% of Dealer:</strong> Each salesperson's share of their dealer's field sales (based on 2025 YTD data). For dealers with multiple salespeople, these percentages sum to ~100%.</li>
                        <li><strong>Dealer 2026 Target:</strong> The dealer's total 2026 target from Dealer x Supplier Targets (Tab 2).</li>
                        <li><strong>Calc. Target:</strong> Dealer Target x Field Sales % x Salesperson's % of Dealer.</li>
                        <li><strong>Total % of Dealer (bottom row):</strong> Field Sales Coverage - shows what % of the expected field sales (from all unique dealers listed) is accounted for by tracked salespeople. A value near 100% means all field sales are attributed.</li>
                    </ul>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #ccc;">
                        <strong style="color: #333;">Data Source:</strong> Salesperson performance based on Jan-Oct 2025 actuals, annualized to full year. Dealer 2026 targets derived from supplier-level target multipliers in Section 2.
                    </div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="section">
                    <h3 class="section-title">Salesperson Summary</h3>
                    <div id="salespeople-summary">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div class="section">
                    <h3 class="section-title">Target Distribution by Dealer</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="salespeopleDealerChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3 class="section-title">Productivity Insights</h3>
                <div class="grid-3" id="salespeople-insights">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>
    
    
    
    <div class="footer">
        XYZ Distribution CEO Portal | Strategic Planning 2026 | Data Period: Jan-Nov 2025 Actuals + December Estimate
    </div>

    <script>
    // =====================================================================
    // DATA
    // =====================================================================
    
    // DATA updated Dec 8, 2025 with November 2025 actuals
    // Data periods: 2024 = Full Year, 2025 = Jan-Nov actuals + Dec projection (85% dealers, 70% non-dealers)
    // Field sales data is only through October 2025 (see salespeople section)
    const DATA = {
        totals: {
            sales_2024: 6781857,           // Full year 2024 (Dealers + Non-Dealers)
            sales_2025_ytd: 5761298,       // Jan-Nov 2025 actuals (Dealers €5,398,937 + Non-Dealers €362,361)
            sales_2025_est: 6291378,       // Full year 2025 projection
            target_2026: 6920516,          // 2026 Target (+10% growth)
            dealers_2024: 5999445,         // Full year 2024 dealer sales
            dealers_2025_ytd: 5398937,     // Jan-Nov 2025 dealer actuals
            dealers_2025_est: 5895215,     // Full year 2025 dealer projection (YTD + Dec @ 85% of Nov)
            nondealers_2024: 782412,       // Full year 2024 non-dealer sales
            nondealers_2025_ytd: 362361,   // Jan-Nov 2025 non-dealer actuals
            nondealers_2025_est: 396164    // Full year 2025 non-dealer projection (YTD + Dec @ 70% of Nov)
        },
        
        // NOTE: sales_2025 = Jan-Nov 2025 actuals (updated Dec 8, 2025)
        dealers: [
            { name: 'Dealer 1', region: 'Region A', greekRegion: 'Region A', sales_2024: 1109918, sales_2025: 1048428 },
            { name: 'Dealer 2', region: 'Region B', greekRegion: 'Region B', sales_2024: 883862, sales_2025: 776829 },
            { name: 'Dealer 3', region: 'Region C', greekRegion: 'Region C', sales_2024: 706704, sales_2025: 651168 },
            { name: 'Dealer 4', region: 'Region D', greekRegion: 'Region D', sales_2024: 543591, sales_2025: 533417 },
            { name: 'Dealer 5', region: 'Region E', greekRegion: 'Region E', sales_2024: 479913, sales_2025: 395858 },
            { name: 'Dealer 6', region: 'Region F', greekRegion: 'Region F', sales_2024: 432614, sales_2025: 404457 },
            { name: 'Dealer 7', region: 'Region G', greekRegion: 'Region G', sales_2024: 396057, sales_2025: 365960 },
            { name: 'Dealer 8', region: 'Region H', greekRegion: 'Region H', sales_2024: 414506, sales_2025: 313707 },
            { name: 'Dealer 9', region: 'Region I', greekRegion: 'Region I', sales_2024: 292623, sales_2025: 281027 },
            { name: 'Dealer 10', region: 'Region J', greekRegion: 'Region J', sales_2024: 201342, sales_2025: 197289 },
            { name: 'Dealer 11', region: 'Region K', greekRegion: 'Region K', sales_2024: 240143, sales_2025: 164757 },
            { name: 'Dealer 12', region: 'Region L', greekRegion: 'Region L', sales_2024: 171698, sales_2025: 146837 },
            { name: 'Dealer 13', region: 'Region M', greekRegion: 'Region M', sales_2024: 113144, sales_2025: 104765 },
            { name: 'Dealer 14', region: 'Region N', greekRegion: 'Region N', sales_2024: 13334, sales_2025: 14442 }
        ],
        
        regions: [
            { name: 'Region A', customers: 6648, pct: 47.8 },
            { name: 'Region B', customers: 3224, pct: 23.2 },
            { name: 'Region C', customers: 1514, pct: 10.9 },
            { name: 'Region D', customers: 1384, pct: 9.9 },
            { name: 'Region E', customers: 672, pct: 4.8 },
            { name: 'Region F', customers: 474, pct: 3.4 },
            { name: 'Region G', customers: 0, pct: 0 }
        ],
        
        suppliers: [
            { name: 'Supplier 1', sales_2024: 1149438, sales_2025: 1340948, unitsChg: 8.1, ppuChg: 7.9, class: 'DOUBLE WIN', classColor: 'green' },
            { name: 'Supplier 2', sales_2024: 985098, sales_2025: 878730, unitsChg: 14.0, ppuChg: -21.8, class: 'PRICE COLLAPSE', classColor: 'warning' },
            { name: 'Supplier 3', sales_2024: 783527, sales_2025: 746643, unitsChg: -3.5, ppuChg: -1.2, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 5', sales_2024: 231450, sales_2025: 228470, unitsChg: -3.5, ppuChg: 2.3, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 6', sales_2024: 241583, sales_2025: 209619, unitsChg: -7.3, ppuChg: -6.4, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 7', sales_2024: 220055, sales_2025: 176834, unitsChg: -19.9, ppuChg: 0.4, class: 'VOLUME COLLAPSE', classColor: 'red' },
            { name: 'Supplier 8', sales_2024: 145311, sales_2025: 145679, unitsChg: 23.5, ppuChg: -18.8, class: 'PRICE COLLAPSE', classColor: 'warning' },
            { name: 'Supplier 9', sales_2024: 191852, sales_2025: 176517, unitsChg: -7.7, ppuChg: -0.4, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 10', sales_2024: 124575, sales_2025: 137265, unitsChg: 7.7, ppuChg: 2.3, class: 'VOLUME LED', classColor: 'blue' },
            { name: 'Supplier 4', sales_2024: 466713, sales_2025: 115514, unitsChg: -19.9, ppuChg: -69.1, class: 'VOLUME COLLAPSE', classColor: 'red' },
            { name: 'Supplier 11', sales_2024: 68598, sales_2025: 99498, unitsChg: 45.9, ppuChg: -0.6, class: 'VOLUME LED', classColor: 'blue' },
            { name: 'Supplier 12', sales_2024: 163038, sales_2025: 245010, unitsChg: 22.2, ppuChg: 23.0, class: 'DOUBLE WIN', classColor: 'green' },
            { name: 'Supplier 21', sales_2024: 525000, sales_2025: 480000, unitsChg: -5, ppuChg: 3, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 22', sales_2024: 630000, sales_2025: 570000, unitsChg: -8, ppuChg: 5, class: 'STABLE', classColor: 'purple' },
            { name: 'Supplier 19', sales_2024: 0, sales_2025: 0, unitsChg: 0, ppuChg: 0, class: 'NEW', classColor: 'yellow', isNew: true },
            { name: 'Supplier 20', sales_2024: 0, sales_2025: 0, unitsChg: 0, ppuChg: 0, class: 'NEW', classColor: 'yellow', isNew: true }
        ],
        
        // Salespeople Data (from FIELD_SALES_ANALYSIS_SUMMARY.md)
        // 2025 YTD is Jan-Oct, Field Sales = 69.4% of dealer revenue
        salespeople: [
            { name: 'Salesperson 1', dealer: 'Dealer 4', status: 'IN', sales_2025_ytd: 469997 },
            { name: 'Salesperson 2', dealer: 'Dealer 1', status: 'IN', sales_2025_ytd: 367595 },
            { name: 'Salesperson 3', dealer: 'Dealer 2', status: 'IN', sales_2025_ytd: 301335 },
            { name: 'Salesperson 4', dealer: 'Dealer 3', status: 'IN', sales_2025_ytd: 288411 },
            { name: 'Salesperson 5', dealer: 'Dealer 7', status: 'IN', sales_2025_ytd: 280028 },
            { name: 'Salesperson 6', dealer: 'Dealer 8', status: 'IN', sales_2025_ytd: 252834 },
            { name: 'Salesperson 7', dealer: 'Dealer 7', status: 'IN', sales_2025_ytd: 244145 },
            { name: 'Salesperson 8', dealer: 'Dealer 5', status: 'IN', sales_2025_ytd: 242019 },
            { name: 'Salesperson 9', dealer: 'Dealer 5', status: 'IN', sales_2025_ytd: 205925 },
            { name: 'Salesperson 10', dealer: 'Dealer 3', status: 'IN', sales_2025_ytd: 188565 },
            { name: 'Salesperson 11', dealer: 'Dealer 6', status: 'IN', sales_2025_ytd: 166730 },
            { name: 'Salesperson 12', dealer: 'Dealer 1', status: 'IN', sales_2025_ytd: 107705 },
            { name: 'Salesperson 13', dealer: 'Dealer 12', status: 'IN', sales_2025_ytd: 76233 },
            { name: 'Salesperson 14', dealer: 'Dealer 9', status: 'IN', sales_2025_ytd: 44615 },
            { name: 'Salesperson 15', dealer: 'Dealer 1', status: 'IN', sales_2025_ytd: 31607 }
        ],
        
        // Field sales by dealer for 2025 (Jan-Oct)
        fieldSalesByDealer: {
            'Dealer 1': 579338,
            'Dealer 5': 447944,
            'Dealer 7': 524172,
            'Dealer 4': 469997,
            'Dealer 3': 476976,
            'Dealer 2': 301335,
            'Dealer 6': 166730,
            'Dealer 12': 76233,
            'Dealer 8': 252834,
            'Dealer 9': 44615
        },
        
        // Field sales ratio to dealer sales
        fieldSalesRatio: 0.694
    };
    
    // Supplier data for target matrix (anonymized supplier identifiers)
    const MATRIX_SUPPLIERS = ['Supplier 1', 'Supplier 2', 'Supplier 3', 'Supplier 5', 'Supplier 6', 'Supplier 7', 'Supplier 8', 'Supplier 9', 'Supplier 10', 'Supplier 4', 'Supplier 19', 'Supplier 20', 'Supplier 21', 'Supplier 22'];
    
    // Sample dealer x supplier matrix (2025 baseline values in €K)
    // Supplier 19 and Supplier 20 (indices 10 & 11): Values are now DYNAMICALLY calculated
    // by recalculateNewSupplierTargets() based on Layer 1: New Products value (50/50 split).
    // The hardcoded values below at indices 10-11 are ignored; absoluteTargets is used instead.
    const DEALER_SUPPLIER_MATRIX = {
        'Dealer 1': [354, 152, 87, 21, 23, 5, 20, 23, 6, 24, 30, 30, 270, 174],
        'Dealer 2': [141, 57, 57, 36, 27, 29, 15, 38, 17, 8, 21, 21, 225, 183],
        'Dealer 3': [129, 75, 62, 20, 24, 21, 20, 5, 12, 8, 18, 18, 195, 135],
        'Dealer 4': [69, 66, 38, 17, 12, 15, 15, 18, 17, 9, 15, 15, 180, 131],
        'Dealer 5': [63, 45, 45, 14, 17, 14, 9, 5, 12, 2, 11, 11, 135, 72],
        'Dealer 6': [56, 50, 47, 14, 11, 24, 5, 0, 9, 6, 12, 12, 128, 101],
        'Dealer 7': [83, 75, 77, 8, 14, 6, 17, 0, 3, 3, 11, 11, 83, 57],
        'Dealer 8': [53, 44, 35, 17, 8, 15, 11, 20, 6, 8, 9, 9, 68, 51],
        'Dealer 9': [45, 54, 44, 17, 11, 5, 0, 8, 12, 0, 8, 8, 75, 45],
        'Dealer 10': [29, 6, 30, 12, 6, 3, 6, 5, 6, 5, 6, 6, 75, 47],
        'Dealer 11': [26, 21, 21, 5, 9, 5, 2, 12, 9, 5, 5, 5, 30, 27],
        'Dealer 12': [36, 17, 23, 5, 9, 5, 3, 2, 2, 2, 5, 5, 38, 24],
        'Dealer 13': [6, 0, 50, 2, 3, 0, 2, 0, 0, 5, 3, 3, 30, 21],
        'Dealer 14': [3, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 5, 2]
    };
    
    // Target multipliers (initialized to 1.10 for 10% growth)
    let targetMultipliers = {};
    DATA.dealers.forEach(d => {
        targetMultipliers[d.name] = {};
        MATRIX_SUPPLIERS.forEach(s => {
            targetMultipliers[d.name][s] = 1.10;
        });
    });
    
    // Absolute targets for 0-baseline items (New Supplier 1 & 2)
    // Stores {dealerName: {supplierName: absoluteValue}}
    let absoluteTargets = {};
    
    // Initialize absoluteTargets with starting values for New Suppliers
    // These are new products with no 2025 history, but we set 2026 targets based on dealer share
    DATA.dealers.forEach(d => {
        absoluteTargets[d.name] = {
            'New Supplier 1': 0,
            'New Supplier 2': 0
        };
    });
    
    // Recalculate New Supplier targets based on Layer 1 (New Products) value
    // Layer 1 value is split 50/50 between New Supplier 1 and New Supplier 2
    // Each dealer gets a proportional share based on their baseline dealer sales
    function recalculateNewSupplierTargets() {
        const layer1Value = layerValues.layer1 || 0; // in €K
        const perSupplier = layer1Value / 2; // 50/50 split
        
        // Calculate grand total baseline (sum of existing supplier sales, excluding new suppliers)
        let grandBaseline = 0;
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            // Sum indices 0-9 and 12-13 (exclude indices 10-11 which are new suppliers)
            matrix.forEach((val, i) => {
                if (i !== 10 && i !== 11) {
                    grandBaseline += val;
                }
            });
        });
        
        // Distribute proportionally to each dealer
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            // Calculate dealer's baseline (excluding new suppliers)
            let dealerBaseline = 0;
            matrix.forEach((val, i) => {
                if (i !== 10 && i !== 11) {
                    dealerBaseline += val;
                }
            });
            
            // Dealer's proportional share
            const share = grandBaseline > 0 ? dealerBaseline / grandBaseline : 0;
            
            absoluteTargets[dealer.name] = {
                'New Supplier 1': Math.round(share * perSupplier),
                'New Supplier 2': Math.round(share * perSupplier)
            };
        });
    }
    
    // Layer values
    let layerValues = { layer1: 600, layer2: 150, layer3: 75, layer4: 150 };
    
    // Field sales ratio (editable by CEO)
    let fieldSalesRatio = 69.4;
    
    // Salesperson target overrides (null = use calculated, number = override)
    let salespersonOverrides = {};
    
    // =====================================================================
    // UTILITIES
    // =====================================================================
    
    function fmt(val) {
        // Consistent formatting: >= 1M shows as €X.XXM, otherwise €XXXK
        if (Math.abs(val) >= 1000000) return '€' + (val/1000000).toFixed(2) + 'M';
        if (Math.abs(val) >= 1000) return '€' + Math.round(val/1000) + 'K';
        return '€' + Math.round(val);
    }
    
    function fmtK(val) {
        // val is already in K (thousands), so val=1000 means €1,000K = €1M
        // Show values >= 1000K as millions for consistency
        if (Math.abs(val) >= 1000) return '€' + (val/1000).toFixed(2) + 'M';
        return '€' + Math.round(val) + 'K';
    }
    
    function fmtChartK(val) {
        // For chart tooltips/axis - val is in K (thousands)
        // Show values >= 1000K as millions for consistency
        if (Math.abs(val) >= 1000) return '€' + (val/1000).toFixed(2) + 'M';
        return '€' + Math.round(val) + 'K';
    }
    
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
        
        // Initialize tab-specific content
        if (tabId === 'layers') updateLayers();
        if (tabId === 'targets') populateTargetMatrix();
        if (tabId === 'regional') populateRegionalView();
        if (tabId === 'suppliers') populateSupplierAnalysis();
        if (tabId === 'pl') calculatePL();
        if (tabId === 'salespeople') populateSalespeopleView();
    }
    
    // Toggle collapsible sections
    function toggleSection(sectionId) {
        const content = document.getElementById(sectionId);
        const toggle = document.getElementById(sectionId + '-toggle');
        if (content.style.display === 'none') {
            content.style.display = 'block';
            if (toggle) toggle.textContent = '−';
        } else {
            content.style.display = 'none';
            if (toggle) toggle.textContent = '+';
        }
    }
    
    // =====================================================================
    // TARGET MATRIX
    // =====================================================================
    
    function populateTargetMatrix() {
        const tbody = document.getElementById('target-matrix-body');
        let html = '';
        let colTotals = MATRIX_SUPPLIERS.map(() => ({ baseline: 0, target: 0 }));
        let grandBaseline = 0, grandTarget = 0;
        
        // Track growth data for charts
        let dealerGrowthData = [];
        
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || MATRIX_SUPPLIERS.map(() => 0);
            let rowBaseline = 0, rowTarget = 0;
            
            html += `<tr>`;
            html += `<td style="position: sticky; left: 0; background: white; z-index: 5; font-weight: 600;">${dealer.name}</td>`;
            
            MATRIX_SUPPLIERS.forEach((sup, i) => {
                // New Supplier 1 & 2 (indices 10-11) have NO 2025 baseline (new products)
                // Their targets come from absoluteTargets
                const isNewSupplier = (i === 10 || i === 11);
                const baseline = isNewSupplier ? 0 : (matrix[i] || 0);
                const mult = targetMultipliers[dealer.name][sup];
                
                // For new suppliers, use absoluteTargets; for others use multiplier
                const target = isNewSupplier 
                    ? (absoluteTargets[dealer.name]?.[sup] || 0)
                    : (baseline > 0 ? Math.round(baseline * mult) : 0);
                
                rowBaseline += baseline;
                rowTarget += target;
                colTotals[i].baseline += baseline;
                colTotals[i].target += target;
                
                // New Supplier 1 & 2 get yellow highlight, Other Main/Supp (12-13) get grey
                const bgColor = isNewSupplier ? '#fff8e1' : (i >= 12 ? '#f8f8f8' : '');
                html += `<td class="text-right" style="background: ${bgColor};">
                    <div style="font-size: 10px; color: #999;">${fmtK(baseline)}</div>
                    <input type="number" class="editable-input" value="${target}" 
                           onchange="updateTarget('${dealer.name}', '${sup}', this.value, ${baseline})"
                           style="margin-top: 2px;">
                </td>`;
            });
            
            grandBaseline += rowBaseline;
            grandTarget += rowTarget;
            
            // Store dealer growth for chart
            dealerGrowthData.push({
                name: dealer.name,
                baseline: rowBaseline,
                target: rowTarget,
                growth: rowTarget - rowBaseline
            });
            
            const rowGrowth = rowBaseline > 0 ? ((rowTarget / rowBaseline - 1) * 100).toFixed(1) : 0;
            html += `<td class="text-right" style="background: #fff5f5;">
                <div style="font-size: 10px; color: #999;">${fmtK(rowBaseline)}</div>
                <div style="font-weight: 700; color: var(--brand-red);">${fmtK(rowTarget)}</div>
                <div style="font-size: 10px; color: ${rowGrowth >= 0 ? 'var(--positive)' : 'var(--negative)'};">
                    ${rowGrowth >= 0 ? '+' : ''}${rowGrowth}%
                </div>
            </td>`;
            html += `</tr>`;
        });
        
        // Build supplier growth data for chart
        let supplierGrowthData = MATRIX_SUPPLIERS.map((sup, i) => ({
            name: sup,
            baseline: colTotals[i].baseline,
            target: colTotals[i].target,
            growth: colTotals[i].target - colTotals[i].baseline
        }));
        
        // Total row
        html += `<tr class="total-row">`;
        html += `<td style="position: sticky; left: 0; background: #f0f4f8; z-index: 5;"><strong>TOTAL</strong></td>`;
        
        MATRIX_SUPPLIERS.forEach((sup, i) => {
            // New Supplier 1 & 2 (indices 10-11) get yellow highlight, Other Main/Supp (12-13) get grey
            const bgColor = (i >= 10 && i <= 11) ? '#fff3cd' : (i >= 12 ? '#e8e8e8' : '');
            html += `<td class="text-right" style="background: ${bgColor};">
                <div style="font-size: 10px; color: #666;">${fmtK(colTotals[i].baseline)}</div>
                <div style="font-weight: 700;">${fmtK(colTotals[i].target)}</div>
            </td>`;
        });
        
        const grandGrowth = ((grandTarget / grandBaseline - 1) * 100).toFixed(1);
        html += `<td class="text-right" style="background: #ffe5e5;">
            <div style="font-size: 10px; color: #666;">${fmtK(grandBaseline)}</div>
            <div style="font-size: 18px; font-weight: 700; color: var(--brand-red);">${fmtK(grandTarget)}</div>
            <div style="font-size: 11px; color: var(--positive);">+${grandGrowth}%</div>
        </td>`;
        html += `</tr>`;
        
        tbody.innerHTML = html;
        
        // Update the header display
        const growth = grandTarget - grandBaseline;
        const growthPct = ((grandTarget / grandBaseline - 1) * 100).toFixed(1);
        document.getElementById('matrix-baseline-display').textContent = fmtK(grandBaseline);
        document.getElementById('matrix-target-display').textContent = fmtK(grandTarget);
        document.getElementById('matrix-growth-display').textContent = (growth >= 0 ? '+' : '') + fmtK(growth) + ' (' + (parseFloat(growthPct) >= 0 ? '+' : '') + growthPct + '%)';
        
        // Update summary with growth data for charts
        updateTargetSummary(grandBaseline, grandTarget, dealerGrowthData, supplierGrowthData);
    }
    
    function updateTarget(dealer, supplier, value, baseline) {
        const target = parseFloat(value) || 0;
        if (baseline > 0) {
            targetMultipliers[dealer][supplier] = target / baseline;
        } else {
            // For 0-baseline items (New Supplier 1 & 2), store absolute value
            if (!absoluteTargets[dealer]) absoluteTargets[dealer] = {};
            absoluteTargets[dealer][supplier] = target;
        }
        populateTargetMatrix();
    }
    
    // Store chart instances to destroy before recreating
    let growthByDealerChartInstance = null;
    let growthBySupplierChartInstance = null;
    let baselineByDealerChartInstance = null;
    let baselineBySupplierChartInstance = null;
    
    function updateTargetSummary(baseline, target, dealerGrowthData, supplierGrowthData) {
        // Update Baseline Charts (2025)
        updateBaselineByDealerChart(dealerGrowthData);
        updateBaselineBySupplierChart(supplierGrowthData);
        
        // Update Growth Charts (2026)
        updateGrowthByDealerChart(dealerGrowthData);
        updateGrowthBySupplierChart(supplierGrowthData);
    }
    
    function updateBaselineByDealerChart(dealerGrowthData) {
        const ctx = document.getElementById('baselineByDealerChart');
        if (!ctx) return;
        
        // Destroy existing chart
        if (baselineByDealerChartInstance) {
            baselineByDealerChartInstance.destroy();
        }
        
        // Sort by baseline amount (descending) - show ALL 14 dealers
        const sorted = [...dealerGrowthData].sort((a, b) => b.baseline - a.baseline);
        
        baselineByDealerChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sorted.map(d => d.name.length > 14 ? d.name.substring(0, 12) + '...' : d.name),
                datasets: [{
                    label: '2025 Baseline €K',
                    data: sorted.map(d => d.baseline),
                    backgroundColor: '#2E2E2E',
                    borderRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => fmtChartK(ctx.raw) + ' (2025)'
                        }
                    }
                },
                scales: { 
                    x: { 
                        ticks: { callback: v => fmtChartK(v) },
                        grid: { display: false }
                    },
                    y: {
                        ticks: { font: { size: 10 } },
                        grid: { display: false }
                    }
                }
            }
        });
    }
    
    function updateBaselineBySupplierChart(supplierGrowthData) {
        const ctx = document.getElementById('baselineBySupplierChart');
        if (!ctx) return;
        
        // Destroy existing chart
        if (baselineBySupplierChartInstance) {
            baselineBySupplierChartInstance.destroy();
        }
        
        // Sort by baseline amount (descending)
        const sorted = [...supplierGrowthData].sort((a, b) => b.baseline - a.baseline);
        
        baselineBySupplierChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sorted.map(s => s.name),
                datasets: [{
                    label: '2025 Baseline €K',
                    data: sorted.map(s => s.baseline),
                    backgroundColor: '#2E2E2E',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => fmtChartK(ctx.raw) + ' (2025)'
                        }
                    }
                },
                scales: { 
                    y: { 
                        ticks: { callback: v => fmtChartK(v) },
                        grid: { color: '#eee' }
                    },
                    x: {
                        ticks: { 
                            maxRotation: 45,
                            minRotation: 45,
                            font: { size: 10 }
                        },
                        grid: { display: false }
                    }
                }
            }
        });
    }
    
    function updateGrowthByDealerChart(dealerGrowthData) {
        const ctx = document.getElementById('growthByDealerChart');
        if (!ctx) return;
        
        // Destroy existing chart
        if (growthByDealerChartInstance) {
            growthByDealerChartInstance.destroy();
        }
        
        // Sort by growth amount - show ALL 14 dealers
        const sorted = [...dealerGrowthData].sort((a, b) => b.growth - a.growth);
        
        growthByDealerChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sorted.map(d => d.name.length > 14 ? d.name.substring(0, 12) + '...' : d.name),
                datasets: [{
                    label: 'Growth €K',
                    data: sorted.map(d => d.growth),
                    backgroundColor: sorted.map(d => d.growth >= 0 ? '#FF3333' : '#dc3545'),
                    borderRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => fmtChartK(ctx.raw) + ' growth'
                        }
                    }
                },
                scales: { 
                    x: { 
                        ticks: { callback: v => fmtChartK(v) },
                        grid: { display: false }
                    },
                    y: {
                        ticks: { font: { size: 10 } },
                        grid: { display: false }
                    }
                }
            }
        });
    }
    
    function updateGrowthBySupplierChart(supplierGrowthData) {
        const ctx = document.getElementById('growthBySupplierChart');
        if (!ctx) return;
        
        // Destroy existing chart
        if (growthBySupplierChartInstance) {
            growthBySupplierChartInstance.destroy();
        }
        
        // Sort by growth amount
        const sorted = [...supplierGrowthData].sort((a, b) => b.growth - a.growth);
        
        growthBySupplierChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sorted.map(s => s.name),
                datasets: [{
                    label: 'Growth €K',
                    data: sorted.map(s => s.growth),
                    backgroundColor: sorted.map(s => s.growth >= 0 ? '#00AEEF' : '#dc3545'),
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => fmtChartK(ctx.raw) + ' growth'
                        }
                    }
                },
                scales: { 
                    y: { 
                        ticks: { callback: v => fmtChartK(v) },
                        grid: { color: '#eee' }
                    },
                    x: {
                        ticks: { 
                            maxRotation: 45,
                            minRotation: 45,
                            font: { size: 10 }
                        },
                        grid: { display: false }
                    }
                }
            }
        });
    }
    
    function applyGrowthRate() {
        const rate = prompt('Enter growth rate (e.g., 10 for 10%):', '10');
        if (rate === null) return;
        const mult = 1 + (parseFloat(rate) / 100);
        
        DATA.dealers.forEach(d => {
            MATRIX_SUPPLIERS.forEach(s => {
                targetMultipliers[d.name][s] = mult;
            });
        });
        
        populateTargetMatrix();
    }
    
    function resetTargets() {
        DATA.dealers.forEach(d => {
            MATRIX_SUPPLIERS.forEach(s => {
                targetMultipliers[d.name][s] = 1;
            });
        });
        // Reset New Supplier targets based on current Layer 1 value (50/50 split)
        recalculateNewSupplierTargets();
        populateTargetMatrix();
    }
    
    // =====================================================================
    // REGIONAL VIEW
    // =====================================================================
    
    function populateRegionalView() {
        const tbody = document.getElementById('regional-table-body');
        let html = '';
        
        // Total XYZ Distribution sales (including non-dealers) for % calculation
        const totalCompanySales = DATA.totals.sales_2025_est; // demo total (EUR)
        
        // Build regional data with all metrics
        const regionalData = DATA.regions.map(region => {
            const dealers = DATA.dealers.filter(d => d.greekRegion === region.name);
            const dealerNames = dealers.map(d => d.name).join(', ') || '-';
            
            // 2025 Sales for this region
            const sales2025 = dealers.reduce((sum, d) => sum + d.sales_2025, 0);
            
            // % of XYZ Distribution sales
            const pctOfCompany = totalCompanySales > 0 ? (sales2025 / totalCompanySales) * 100 : 0;
            
            // Penetration Index = (% of XYZ Distribution) / (% of market customers)
            const penetrationIndex = region.pct > 0 ? pctOfCompany / region.pct : 0;
            
            // Get 2026 Target from Target Setting matrix
            let target2026 = 0;
            dealers.forEach(dealer => {
                const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
                matrix.forEach((baseline, i) => {
                    const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                    target2026 += Math.round(baseline * mult);
                });
            });
            
            // Growth % vs 2025
            const baselineK = dealers.reduce((sum, d) => {
                const matrix = DEALER_SUPPLIER_MATRIX[d.name] || [];
                return sum + matrix.reduce((a, b) => a + b, 0);
            }, 0);
            const growthPct = baselineK > 0 ? ((target2026 / baselineK - 1) * 100).toFixed(1) : 0;
            
            // Insight based on penetration index
            let insight, insightClass, suggestedGrowth;
            if (dealers.length === 0) {
                insight = 'No Coverage';
                insightClass = 'badge-red';
                suggestedGrowth = 'N/A';
            } else if (penetrationIndex > 1.2) {
                insight = 'Maxed Out';
                insightClass = 'badge-warning';
                suggestedGrowth = '+5-8%';
            } else if (penetrationIndex >= 0.8) {
                insight = 'Balanced';
                insightClass = 'badge-green';
                suggestedGrowth = '+10%';
            } else {
                insight = 'High Potential';
                insightClass = 'badge-blue';
                suggestedGrowth = '+12-15%';
            }
            
            return {
                name: region.name,
                customers: region.customers,
                pctDomesticMarket: region.pct,
                dealers: dealers,
                dealerNames: dealerNames,
                sales2025: sales2025,
                pctOfCompany: pctOfCompany,
                penetrationIndex: penetrationIndex,
                target2026: target2026,
                growthPct: growthPct,
                insight: insight,
                insightClass: insightClass,
                suggestedGrowth: suggestedGrowth
            };
        });
        
        // Build table HTML
        regionalData.forEach(r => {
            html += `<tr>
                <td><strong>${r.name}</strong></td>
                <td class="text-right">${r.customers.toLocaleString()}</td>
                <td class="text-right">${r.pctDomesticMarket}%</td>
                <td>${r.dealerNames}</td>
                <td class="text-right">${fmt(r.sales2025)}</td>
                <td class="text-right">${r.pctOfCompany.toFixed(1)}%</td>
                <td class="text-right" style="font-weight: 600; ${r.penetrationIndex > 1.2 ? 'color: var(--warning);' : r.penetrationIndex < 0.8 ? 'color: var(--brand-blue);' : 'color: var(--positive);'}">${r.penetrationIndex.toFixed(2)}</td>
                <td class="text-right">${r.dealers.length > 0 ? fmtK(r.target2026) + ' <span style="font-size:10px;color:' + (parseFloat(r.growthPct) >= 0 ? 'var(--positive)' : 'var(--negative)') + ';">(' + (parseFloat(r.growthPct) >= 0 ? '+' : '') + r.growthPct + '%)</span>' : '-'}</td>
                <td class="text-center"><span class="badge ${r.insightClass}">${r.insight}</span></td>
            </tr>`;
        });
        
        tbody.innerHTML = html;
        
        // Generate Growth Opportunity Insights
        const highPotential = regionalData.filter(r => r.insight === 'High Potential').sort((a, b) => a.penetrationIndex - b.penetrationIndex);
        const maxedOut = regionalData.filter(r => r.insight === 'Maxed Out').sort((a, b) => b.penetrationIndex - a.penetrationIndex);
        const noCoverage = regionalData.filter(r => r.insight === 'No Coverage');
        
        let insightsHtml = '';
        
        // High Potential Card
        insightsHtml += `<div class="highlight-box" style="background: #f0f7ff; border-left: 4px solid var(--brand-blue);">
            <div class="highlight-header blue">🚀 High Growth Potential</div>
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
                Penetration Index &lt;0.8 — Under-represented vs customer population. <strong>Increase targets +12-15%</strong>
            </div>`;
        if (highPotential.length > 0) {
            highPotential.forEach(r => {
                insightsHtml += `<div class="highlight-item">
                    <strong>${r.name}</strong> (Index: ${r.penetrationIndex.toFixed(2)})
                    <div style="font-size: 11px; color: var(--text-muted);">Dealers: ${r.dealerNames} — ${r.pctDomesticMarket}% of customers but only ${r.pctOfCompany.toFixed(1)}% of sales</div>
                </div>`;
            });
        } else {
            insightsHtml += `<div class="highlight-item" style="color: var(--text-muted);">No regions with high untapped potential</div>`;
        }
        insightsHtml += `</div>`;
        
        // Maxed Out Card
        insightsHtml += `<div class="highlight-box" style="background: #fff8f0; border-left: 4px solid var(--warning);">
            <div class="highlight-header" style="border-color: var(--warning);">⚠️ Maxed Out Regions</div>
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
                Penetration Index &gt;1.2 — Over-performing vs customer population. <strong>Conservative targets +5-8%</strong>
            </div>`;
        if (maxedOut.length > 0) {
            maxedOut.forEach(r => {
                insightsHtml += `<div class="highlight-item">
                    <strong>${r.name}</strong> (Index: ${r.penetrationIndex.toFixed(2)})
                    <div style="font-size: 11px; color: var(--text-muted);">Dealers: ${r.dealerNames} — Only ${r.pctDomesticMarket}% of customers but ${r.pctOfCompany.toFixed(1)}% of sales</div>
                </div>`;
            });
        } else {
            insightsHtml += `<div class="highlight-item" style="color: var(--text-muted);">No maxed out regions</div>`;
        }
        insightsHtml += `</div>`;
        
        // No Coverage Card
        insightsHtml += `<div class="highlight-box" style="background: #fff5f5; border-left: 4px solid var(--negative);">
            <div class="highlight-header red">❌ No Coverage Alert</div>
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
                Regions with customers but no XYZ Distribution dealer presence. <strong>Consider expansion.</strong>
            </div>`;
        if (noCoverage.length > 0) {
            noCoverage.forEach(r => {
                insightsHtml += `<div class="highlight-item">
                    <strong>${r.name}</strong>
                    <div style="font-size: 11px; color: var(--text-muted);">${r.customers.toLocaleString()} customers (${r.pctDomesticMarket}% of market) — €0 sales</div>
                </div>`;
            });
        } else {
            insightsHtml += `<div class="highlight-item" style="color: var(--positive);">All regions covered!</div>`;
        }
        insightsHtml += `</div>`;
        
        document.getElementById('regional-insights').innerHTML = insightsHtml;
        
        // Regional summary cards (top 8 by sales)
        const topRegions = [...regionalData].filter(r => r.sales2025 > 0).sort((a, b) => b.sales2025 - a.sales2025).slice(0, 8);
        const cardsHtml = topRegions.map(r => {
            return `<div class="region-card">
                <div class="region-name">${r.name}</div>
                <div class="region-stats">
                    <span>${r.customers.toLocaleString()} customers</span>
                    <span>Index: ${r.penetrationIndex.toFixed(2)}</span>
                </div>
                <div class="region-stats">
                    <span>2025: ${fmt(r.sales2025)}</span>
                    <span>2026: ${fmtK(r.target2026)}</span>
                </div>
                <div class="region-dealers" style="margin-top: 5px;">
                    <span class="badge ${r.insightClass}" style="font-size: 9px;">${r.insight} ${r.suggestedGrowth}</span>
                </div>
            </div>`;
        }).join('');
        
        document.getElementById('regional-cards').innerHTML = cardsHtml;
    }
    
    // =====================================================================
    // GROWTH LAYERS
    // =====================================================================
    
    function updateLayers(skipSave = false) {
        layerValues.layer1 = parseInt(document.getElementById('layer1').value) || 0;
        layerValues.layer2 = parseInt(document.getElementById('layer2').value) || 0;
        layerValues.layer3 = parseInt(document.getElementById('layer3').value) || 0;
        layerValues.layer4 = parseInt(document.getElementById('layer4').value) || 0;
        
        document.getElementById('layer1-value').textContent = layerValues.layer1;
        document.getElementById('layer2-value').textContent = layerValues.layer2;
        document.getElementById('layer3-value').textContent = layerValues.layer3;
        document.getElementById('layer4-value').textContent = layerValues.layer4;
        
        // Recalculate New Supplier targets based on Layer 1 (New Products) value
        // This links the 50/50 split for New Supplier 1 & 2 to the Layer 1 input
        recalculateNewSupplierTargets();
        
        // Refresh the target matrix to reflect updated new supplier targets
        populateTargetMatrix();
        
        // Auto-save when layers change (unless skipped during initial load)
        if (!skipSave) {
            saveToLocalStorage(true);
        }
        
        const baseline = DATA.totals.sales_2025_est;
        const l1 = layerValues.layer1 * 1000;
        const l2 = layerValues.layer2 * 1000;
        const l3 = layerValues.layer3 * 1000;
        const l4 = layerValues.layer4 * 1000;
        const totalImpact = l1 + l2 + l3 + l4;
        
        document.getElementById('layer1-impact').textContent = fmt(l1);
        document.getElementById('layer2-impact').textContent = fmt(l2);
        document.getElementById('layer3-impact').textContent = fmt(l3);
        document.getElementById('layer4-impact').textContent = fmt(l4);
        
        // Calculate percentage shares
        const share1 = totalImpact > 0 ? Math.round((l1 / totalImpact) * 100) : 0;
        const share2 = totalImpact > 0 ? Math.round((l2 / totalImpact) * 100) : 0;
        const share3 = totalImpact > 0 ? Math.round((l3 / totalImpact) * 100) : 0;
        const share4 = totalImpact > 0 ? Math.round((l4 / totalImpact) * 100) : 0;
        
        document.getElementById('layer1-share').textContent = share1 + '%';
        document.getElementById('layer2-share').textContent = share2 + '%';
        document.getElementById('layer3-share').textContent = share3 + '%';
        document.getElementById('layer4-share').textContent = share4 + '%';
        
        // Update Waterfall Visualization
        const target2026 = baseline + totalImpact;
        const maxVal = Math.max(baseline, target2026);
        const baselineHeight = (baseline / maxVal) * 140;
        const targetHeight = (target2026 / maxVal) * 140;
        const l1Height = totalImpact > 0 ? (l1 / maxVal) * 140 : 0;
        const l2Height = totalImpact > 0 ? (l2 / maxVal) * 140 : 0;
        const l3Height = totalImpact > 0 ? (l3 / maxVal) * 140 : 0;
        const l4Height = totalImpact > 0 ? (l4 / maxVal) * 140 : 0;
        
        document.getElementById('wf-baseline').style.height = baselineHeight + 'px';
        document.getElementById('wf-baseline-val').textContent = fmt(baseline);
        document.getElementById('wf-l1').style.height = Math.max(l1Height, l1 > 0 ? 4 : 0) + 'px';
        document.getElementById('wf-l1-val').textContent = '+' + fmt(l1);
        document.getElementById('wf-l2').style.height = Math.max(l2Height, l2 > 0 ? 4 : 0) + 'px';
        document.getElementById('wf-l2-val').textContent = '+' + fmt(l2);
        document.getElementById('wf-l3').style.height = Math.max(l3Height, l3 > 0 ? 4 : 0) + 'px';
        document.getElementById('wf-l3-val').textContent = '+' + fmt(l3);
        document.getElementById('wf-l4').style.height = Math.max(l4Height, l4 > 0 ? 4 : 0) + 'px';
        document.getElementById('wf-l4-val').textContent = '+' + fmt(l4);
        document.getElementById('wf-target').style.height = targetHeight + 'px';
        document.getElementById('wf-target-val').textContent = fmt(target2026);
        
        // Update Percentage Breakdown Bar
        document.getElementById('bd-l1').style.width = share1 + '%';
        document.getElementById('bd-l1').textContent = share1 > 8 ? share1 + '%' : '';
        document.getElementById('bd-l2').style.width = share2 + '%';
        document.getElementById('bd-l2').textContent = share2 > 8 ? share2 + '%' : '';
        document.getElementById('bd-l3').style.width = share3 + '%';
        document.getElementById('bd-l3').textContent = share3 > 8 ? share3 + '%' : '';
        document.getElementById('bd-l4').style.width = share4 + '%';
        document.getElementById('bd-l4').textContent = share4 > 8 ? share4 + '%' : '';
        
        document.getElementById('total-layers-impact').textContent = '+' + fmt(totalImpact);
        document.getElementById('total-2026-target').textContent = fmt(baseline + totalImpact);
        
        // Calculate and display % growth from baseline
        const layersPctGrowth = baseline > 0 ? ((totalImpact / baseline) * 100).toFixed(1) : 0;
        document.getElementById('total-layers-pct').textContent = '+' + layersPctGrowth + '% from baseline';
        
        // Update Executive Summary with Growth Layers values
        const summaryTarget = document.getElementById('summary-2026-target');
        const summaryPct = document.getElementById('summary-growth-pct');
        const summaryAmount = document.getElementById('summary-growth-amount');
        const summaryL1 = document.getElementById('summary-layer1');
        const summaryL2 = document.getElementById('summary-layer2');
        const summaryL3 = document.getElementById('summary-layer3');
        const summaryL4 = document.getElementById('summary-layer4');
        
        if (summaryTarget) summaryTarget.textContent = fmt(baseline + totalImpact);
        if (summaryPct) summaryPct.textContent = '+' + layersPctGrowth + '%';
        if (summaryAmount) summaryAmount.textContent = fmt(totalImpact);
        if (summaryL1) summaryL1.textContent = fmt(l1);
        if (summaryL2) summaryL2.textContent = fmt(l2);
        if (summaryL3) summaryL3.textContent = fmt(l3);
        if (summaryL4) summaryL4.textContent = fmt(l4);
        
        // Update scorecard in Executive Summary
        const scorecardTarget = document.getElementById('scorecard-2026-target');
        const scorecardPct = document.getElementById('scorecard-growth-pct');
        if (scorecardTarget) scorecardTarget.textContent = fmt(baseline + totalImpact);
        if (scorecardPct) scorecardPct.textContent = '+' + layersPctGrowth + '% Growth';
        
        // Calculate matrix total from Target Setting
        let matrixBaseline = 0;
        let matrixTarget = 0;
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            matrix.forEach((base, i) => {
                matrixBaseline += base;
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                matrixTarget += Math.round(base * mult);
            });
        });
        const matrixGrowth = matrixTarget - matrixBaseline;
        
        document.getElementById('matrix-total-growth').textContent = (matrixGrowth >= 0 ? '+' : '') + fmtK(matrixGrowth);
        document.getElementById('matrix-total-2026').textContent = fmtK(matrixTarget);
        
        // Calculate and display % growth for matrix (using same baseline)
        const matrixPctGrowth = baseline > 0 ? ((matrixGrowth / baseline) * 100).toFixed(1) : 0;
        document.getElementById('matrix-total-pct').textContent = (parseFloat(matrixPctGrowth) >= 0 ? '+' : '') + matrixPctGrowth + '% from baseline';
        
        // Calculate variance
        const layerTargetK = (baseline + totalImpact) / 1000;
        const variance = layerTargetK - matrixTarget;
        
        // Update dealer gap indicator in stepped layout
        const dealerGapIndicator = document.getElementById('dealer-gap-indicator');
        if (dealerGapIndicator) {
            if (Math.abs(variance) <= 50) {
                dealerGapIndicator.innerHTML = '<span style="color: var(--positive);">Aligned with growth target</span>';
            } else if (variance > 0) {
                dealerGapIndicator.innerHTML = `<span style="color: var(--warning);">€${Math.round(variance)}K below growth target</span>`;
            } else {
                dealerGapIndicator.innerHTML = `<span style="color: var(--positive);">€${Math.round(Math.abs(variance))}K above growth target</span>`;
            }
        }
        
        // Store dealer variance for reconciliation banner
        window.dealerVariance = variance;
        
        // Update reconciliation banner
        updateReconciliationBanner();
        
        // Update field sales summary in Growth Layers tab
        updateFieldTotalsInGrowthLayers();
    }
    
    // Update the combined reconciliation banner
    function updateReconciliationBanner() {
        const banner = document.getElementById('reconciliation-banner');
        const msgEl = document.getElementById('reconciliation-message');
        if (!banner || !msgEl) return;
        
        const dealerVar = window.dealerVariance || 0;
        const fieldVar = window.fieldVariance || 0;
        
        let messages = [];
        let hasIssues = false;
        
        // Check dealer variance
        if (Math.abs(dealerVar) > 50) {
            hasIssues = true;
            if (dealerVar > 0) {
                messages.push(`Dealer allocation is <strong>€${Math.round(dealerVar)}K below</strong> growth target`);
            } else {
                messages.push(`Dealer allocation is <strong>€${Math.round(Math.abs(dealerVar))}K above</strong> growth target`);
            }
        }
        
        // Check field variance
        if (Math.abs(fieldVar) > 50000) {
            hasIssues = true;
            if (fieldVar < 0) {
                messages.push(`Field sales is <strong>€${Math.round(Math.abs(fieldVar)/1000)}K below</strong> expected share`);
            } else {
                messages.push(`Field sales is <strong>€${Math.round(fieldVar/1000)}K above</strong> expected share`);
            }
        }
        
        if (!hasIssues) {
            banner.style.background = '#f0f9f0';
            banner.style.borderColor = 'var(--positive)';
            msgEl.innerHTML = 'All allocations are aligned with your growth target.';
        } else {
            banner.style.background = '#fff8f0';
            banner.style.borderColor = '#ffcc80';
            msgEl.innerHTML = messages.join('. ') + '.';
        }
    }
    
    // =====================================================================
    // SUPPLIER ANALYSIS
    // =====================================================================
    
    function populateSupplierAnalysis() {
        const tbody = document.getElementById('supplier-table-body');
        let html = '';
        
        // Build supplier data directly from matrix (aligned with Tab 2)
        const supplierData = [];
        
        // Display names for matrix suppliers (strict anonymization)
        const displayNames = {
            'Supplier 1': 'Supplier 1',
            'Supplier 2': 'Supplier 2',
            'Supplier 3': 'Supplier 3',
            'Supplier 4': 'Supplier 4',
            'Supplier 5': 'Supplier 5',
            'Supplier 6': 'Supplier 6',
            'Supplier 7': 'Supplier 7',
            'Supplier 8': 'Supplier 8',
            'Supplier 9': 'Supplier 9',
            'Supplier 10': 'Supplier 10',
            'Supplier 19': 'Supplier 19',
            'Supplier 20': 'Supplier 20',
            'Supplier 21': 'Supplier 21',
            'Supplier 22': 'Supplier 22'
        };
        
        // Classification data from original analysis
        const supplierClassifications = {
            'Supplier 1': { class: 'DOUBLE WIN', classColor: 'green', unitsChg: 8.1, ppuChg: 7.9 },
            'Supplier 2': { class: 'PRICE COLLAPSE', classColor: 'warning', unitsChg: 14.0, ppuChg: -21.8 },
            'Supplier 3': { class: 'STABLE', classColor: 'purple', unitsChg: -3.5, ppuChg: -1.2 },
            'Supplier 4': { class: 'VOLUME COLLAPSE', classColor: 'red', unitsChg: -19.9, ppuChg: -69.1 },
            'Supplier 5': { class: 'STABLE', classColor: 'purple', unitsChg: -3.5, ppuChg: 2.3 },
            'Supplier 6': { class: 'STABLE', classColor: 'purple', unitsChg: -7.3, ppuChg: -6.4 },
            'Supplier 7': { class: 'VOLUME COLLAPSE', classColor: 'red', unitsChg: -19.9, ppuChg: 0.4 },
            'Supplier 8': { class: 'PRICE COLLAPSE', classColor: 'warning', unitsChg: 23.5, ppuChg: -18.8 },
            'Supplier 9': { class: 'STABLE', classColor: 'purple', unitsChg: -7.7, ppuChg: -0.4 },
            'Supplier 10': { class: 'VOLUME LED', classColor: 'blue', unitsChg: 7.7, ppuChg: 2.3 },
            'Supplier 19': { class: 'NEW', classColor: 'yellow', unitsChg: 0, ppuChg: 0 },
            'Supplier 20': { class: 'NEW', classColor: 'yellow', unitsChg: 0, ppuChg: 0 },
            'Supplier 21': { class: 'STABLE', classColor: 'purple', unitsChg: -5, ppuChg: 3 },
            'Supplier 22': { class: 'STABLE', classColor: 'purple', unitsChg: -8, ppuChg: 5 }
        };
        
        // Calculate baseline and target for each supplier from matrix
        MATRIX_SUPPLIERS.forEach((sup, i) => {
            const isNewSupplier = (i === 10 || i === 11);
            let baseline = 0;
            let target = 0;
            
            DATA.dealers.forEach(dealer => {
                const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
                if (isNewSupplier) {
                    // New suppliers use absoluteTargets
                    target += absoluteTargets[dealer.name]?.[sup] || 0;
                } else {
                    const b = matrix[i] || 0;
                    baseline += b;
                    const mult = targetMultipliers[dealer.name]?.[sup] || 1.1;
                    target += Math.round(b * mult);
                }
            });
            
            supplierData.push({
                name: displayNames[sup] || sup,
                matrixKey: sup,
                baseline: baseline * 1000,
                target: target * 1000,
                isNew: isNewSupplier,
                ...supplierClassifications[sup]
            });
        });
        
        // Totals accumulators
        let total2025 = 0;
        let total2026 = 0;
        
        supplierData.forEach(sup => {
            total2025 += sup.baseline;
            total2026 += sup.target;
            
            // Calculate growth
            const growthPct = sup.baseline > 0 ? ((sup.target / sup.baseline - 1) * 100).toFixed(1) : (sup.target > 0 ? '100.0' : '0.0');
            
            const badgeClass = {
                'green': 'badge-green',
                'blue': 'badge-blue',
                'warning': 'badge-warning',
                'red': 'badge-red',
                'purple': 'badge-purple',
                'yellow': 'badge-warning'
            }[sup.classColor];
            
            // For new suppliers, show different styling
            const rowStyle = sup.isNew ? 'background: #fff8e1;' : '';
            
            html += `<tr style="${rowStyle}">
                <td><strong>${sup.name}</strong></td>
                <td class="text-right">${sup.isNew ? '-' : fmt(sup.baseline)}</td>
                <td class="text-right ${!sup.isNew && parseFloat(growthPct) >= 0 ? 'positive' : (!sup.isNew && parseFloat(growthPct) < 0 ? 'negative' : '')}">${sup.isNew ? '-' : (growthPct >= 0 ? '+' : '') + growthPct + '%'}</td>
                <td class="text-right ${!sup.isNew && sup.unitsChg >= 0 ? 'positive' : (!sup.isNew ? 'negative' : '')}">${sup.isNew ? '-' : (sup.unitsChg >= 0 ? '+' : '') + sup.unitsChg + '%'}</td>
                <td class="text-right ${!sup.isNew && sup.ppuChg >= 0 ? 'positive' : (!sup.isNew ? 'negative' : '')}">${sup.isNew ? '-' : (sup.ppuChg >= 0 ? '+' : '') + sup.ppuChg + '%'}</td>
                <td class="text-center"><span class="badge ${badgeClass}">${sup.class}</span></td>
                <td class="text-right"><span style="font-weight: 700; color: var(--brand-dark);">${fmt(sup.target)}</span></td>
            </tr>`;
        });
        
        // Add totals row
        const totalGrowthPct = total2025 > 0 ? ((total2026 / total2025 - 1) * 100).toFixed(1) : '0.0';
        
        html += `<tr style="background: #f0f4f8; font-weight: 700; border-top: 2px solid var(--brand-dark);">
            <td><strong>TOTAL</strong></td>
            <td class="text-right">${fmt(total2025)}</td>
            <td class="text-right ${parseFloat(totalGrowthPct) >= 0 ? 'positive' : 'negative'}">${totalGrowthPct >= 0 ? '+' : ''}${totalGrowthPct}%</td>
            <td class="text-right">-</td>
            <td class="text-right">-</td>
            <td class="text-center">-</td>
            <td class="text-right"><span style="font-weight: 700; color: var(--brand-dark);">${fmt(total2026)}</span></td>
        </tr>`;
        
        tbody.innerHTML = html;
        
        // Update supplier classification chart
        initSupplierChart();
    }
    
    function initSupplierChart() {
        const ctx = document.getElementById('supplierClassChart');
        if (!ctx) return;
        
        const classes = {
            'DOUBLE WIN': { count: 0, value: 0, color: '#28a745' },
            'VOLUME LED': { count: 0, value: 0, color: '#00AEEF' },
            'PRICE COLLAPSE': { count: 0, value: 0, color: '#f59e0b' },
            'VOLUME COLLAPSE': { count: 0, value: 0, color: '#dc3545' },
            'STABLE': { count: 0, value: 0, color: '#8b5cf6' }
        };
        
        DATA.suppliers.forEach(sup => {
            if (classes[sup.class]) {
                classes[sup.class].count++;
                classes[sup.class].value += sup.sales_2025;
            }
        });
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(classes),
                datasets: [{
                    label: '2025 Sales',
                    data: Object.values(classes).map(c => c.value / 1000),
                    backgroundColor: Object.values(classes).map(c => c.color),
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { callback: v => fmtChartK(v) }
                    }
                }
            }
        });
    }
    
    // =====================================================================
    // P&L CALCULATOR
    // =====================================================================
    
    function calculatePL() {
        const revenue = parseFloat(document.getElementById('pl-revenue').value) || 0;
        const cogsRate = parseFloat(document.getElementById('pl-cogs').value) || 0;
        const opex = parseFloat(document.getElementById('pl-opex').value) || 0;
        const other = parseFloat(document.getElementById('pl-other').value) || 0;
        
        const cogs = revenue * (cogsRate / 100);
        const grossMargin = revenue - cogs;
        const grossPct = ((grossMargin / revenue) * 100).toFixed(1);
        const netProfit = grossMargin - opex - other;
        const netPct = ((netProfit / revenue) * 100).toFixed(1);
        
        document.getElementById('pl-gross-margin').textContent = fmt(grossMargin);
        document.getElementById('pl-gross-pct').textContent = grossPct + '%';
        document.getElementById('pl-net-profit').textContent = fmt(netProfit);
        document.getElementById('pl-net-pct').textContent = netPct + '%';
        
        // 2025 comparison (estimate same margins)
        const revenue2025 = DATA.totals.sales_2025_est;
        const netProfit2025 = revenue2025 * (1 - cogsRate/100) - opex - other;
        const improvement = netProfit - netProfit2025;
        
        document.getElementById('pl-vs-2025').textContent = (improvement >= 0 ? '+' : '') + fmt(improvement) + ' improvement';
        
        // P&L Table
        const tbody = document.getElementById('pl-table-body');
        tbody.innerHTML = `
            <tr>
                <td><strong>Revenue</strong></td>
                <td class="text-right">${fmt(revenue2025)}</td>
                <td class="text-right">${fmt(revenue)}</td>
                <td class="text-right positive">+${fmt(revenue - revenue2025)}</td>
            </tr>
            <tr>
                <td>Cost of Goods Sold</td>
                <td class="text-right">(${fmt(revenue2025 * cogsRate / 100)})</td>
                <td class="text-right">(${fmt(cogs)})</td>
                <td class="text-right negative">(${fmt(cogs - revenue2025 * cogsRate / 100)})</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td><strong>Gross Margin</strong></td>
                <td class="text-right"><strong>${fmt(revenue2025 * (1 - cogsRate/100))}</strong></td>
                <td class="text-right"><strong>${fmt(grossMargin)}</strong></td>
                <td class="text-right positive"><strong>+${fmt(grossMargin - revenue2025 * (1 - cogsRate/100))}</strong></td>
            </tr>
            <tr>
                <td>Operating Expenses</td>
                <td class="text-right">(${fmt(opex)})</td>
                <td class="text-right">(${fmt(opex)})</td>
                <td class="text-right">-</td>
            </tr>
            <tr>
                <td>Other Costs</td>
                <td class="text-right">(${fmt(other)})</td>
                <td class="text-right">(${fmt(other)})</td>
                <td class="text-right">-</td>
            </tr>
            <tr class="total-row">
                <td><strong>Net Profit</strong></td>
                <td class="text-right" style="color: var(--positive);"><strong>${fmt(netProfit2025)}</strong></td>
                <td class="text-right" style="color: var(--positive);"><strong>${fmt(netProfit)}</strong></td>
                <td class="text-right" style="color: var(--positive);"><strong>+${fmt(improvement)}</strong></td>
            </tr>
        `;
    }
    
    // =====================================================================
    // SALESPEOPLE TARGETS
    // =====================================================================
    
    let salespeopleDealerChartInstance = null;
    
    // Update field sales ratio
    function updateFieldSalesRatio(value) {
        fieldSalesRatio = parseFloat(value) || 69.4;
        document.getElementById('field-ratio-display').textContent = fieldSalesRatio.toFixed(1);
        const fieldRatioNote = document.getElementById('field-ratio-note');
        if (fieldRatioNote) fieldRatioNote.textContent = fieldSalesRatio.toFixed(1);
        populateSalespeopleView();
        saveToLocalStorage(true);
    }
    
    // Update salesperson override
    function updateSalespersonTarget(personName, value, calculatedTarget) {
        const numValue = parseInt(value) || 0;
        // If value matches calculated (within tolerance), clear override
        if (Math.abs(numValue - calculatedTarget) < 10) {
            delete salespersonOverrides[personName];
        } else {
            salespersonOverrides[personName] = numValue;
        }
        populateSalespeopleView();
        updateFieldTotalsInGrowthLayers();
        saveToLocalStorage(true);
    }
    
    // Update field sales totals in Growth Layers tab
    function updateFieldTotalsInGrowthLayers() {
        // Calculate total field salesperson targets
        let totalFieldRepTargets = 0;
        const dealerTargets = {};
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            let target = 0;
            matrix.forEach((baseline, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                target += Math.round(baseline * mult);
            });
            dealerTargets[dealer.name] = target * 1000;
        });
        
        DATA.salespeople.forEach(person => {
            const ytd = person.sales_2025_ytd;
            const dealerFieldSales = DATA.fieldSalesByDealer[person.dealer] || 1;
            const personShareOfDealer = ytd / dealerFieldSales;
            const dealerTarget = dealerTargets[person.dealer] || 0;
            const dealerFieldTarget = dealerTarget * (fieldSalesRatio / 100);
            const calculatedTarget = Math.round(dealerFieldTarget * personShareOfDealer);
            const finalTarget = salespersonOverrides[person.name] !== undefined ? salespersonOverrides[person.name] : calculatedTarget;
            totalFieldRepTargets += finalTarget;
        });
        
        // Calculate Expected Field Share = Field % x Total 2026 Strategic Target
        const baseline = DATA.totals.sales_2025_est;
        const totalLayerImpact = (layerValues.layer1 + layerValues.layer2 + layerValues.layer3 + layerValues.layer4) * 1000;
        const target2026 = baseline + totalLayerImpact;
        const expectedFieldShare = target2026 * (fieldSalesRatio / 100);
        const variance = totalFieldRepTargets - expectedFieldShare;
        
        // Update Growth Layers display
        const fieldTotalEl = document.getElementById('field-total-target');
        const fieldGapIndicator = document.getElementById('field-gap-indicator');
        
        if (fieldTotalEl) fieldTotalEl.textContent = fmt(totalFieldRepTargets);
        
        // Update field gap indicator in stepped layout
        if (fieldGapIndicator) {
            if (Math.abs(variance) <= 50000) {
                fieldGapIndicator.innerHTML = '<span style="color: var(--positive);">Aligned with expected share</span>';
            } else if (variance > 0) {
                fieldGapIndicator.innerHTML = `<span style="color: var(--positive);">€${Math.round(variance/1000)}K above expected share</span>`;
            } else {
                fieldGapIndicator.innerHTML = `<span style="color: var(--warning);">€${Math.round(Math.abs(variance)/1000)}K below expected share</span>`;
            }
        }
        
        // Store field variance for reconciliation banner
        window.fieldVariance = variance;
        
        // Update reconciliation banner
        updateReconciliationBanner();
    }
    
    function populateSalespeopleView() {
        const tbody = document.getElementById('salespeople-table-body');
        let html = '';
        
        // Update field ratio display
        document.getElementById('field-ratio-display').textContent = fieldSalesRatio.toFixed(1);
        document.getElementById('field-sales-ratio').value = fieldSalesRatio;
        
        // Calculate dealer targets from the matrix
        const dealerTargets = {};
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            let target = 0;
            matrix.forEach((baseline, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                target += Math.round(baseline * mult);
            });
            dealerTargets[dealer.name] = target * 1000; // Convert from K to euros
        });
        
        // Calculate totals
        let totalYTD = 0;
        let totalAnnualized = 0;
        let totalCalculatedTarget = 0;
        let totalFinalTarget = 0;
        const uniqueDealers = new Set();
        const repData = [];
        
        DATA.salespeople.forEach(person => {
            const ytd = person.sales_2025_ytd;
            const annualized = Math.round(ytd * (12 / 10)); // Annualize Jan-Oct
            
            // Get dealer's field sales for 2025 (YTD)
            const dealerFieldSales = DATA.fieldSalesByDealer[person.dealer] || 1;
            const personShareOfDealer = ytd / dealerFieldSales;
            
            // Get dealer's 2026 target
            const dealerTarget = dealerTargets[person.dealer] || 0;
            
            // Field sales portion of dealer target (using editable ratio)
            const dealerFieldTarget = dealerTarget * (fieldSalesRatio / 100);
            
            // Salesperson's calculated 2026 target
            const calculatedTarget = Math.round(dealerFieldTarget * personShareOfDealer);
            
            // Check for override
            const hasOverride = salespersonOverrides[person.name] !== undefined;
            const finalTarget = hasOverride ? salespersonOverrides[person.name] : calculatedTarget;
            
            // Growth %
            const growthPct = annualized > 0 ? ((finalTarget / annualized - 1) * 100).toFixed(1) : 0;
            
            totalYTD += ytd;
            totalAnnualized += annualized;
            totalCalculatedTarget += calculatedTarget;
            totalFinalTarget += finalTarget;
            uniqueDealers.add(person.dealer);
            
            repData.push({
                name: person.name,
                dealer: person.dealer,
                ytd: ytd,
                annualized: annualized,
                shareOfDealer: personShareOfDealer * 100,
                dealerTarget: dealerTarget,
                calculatedTarget: calculatedTarget,
                finalTarget: finalTarget,
                hasOverride: hasOverride,
                growthPct: growthPct
            });
        });
        
        // Sort by dealer name first, then by final target within each dealer
        repData.sort((a, b) => {
            if (a.dealer !== b.dealer) {
                return a.dealer.localeCompare(b.dealer, 'el'); // Greek locale for proper sorting
            }
            return b.finalTarget - a.finalTarget; // Within dealer, sort by target descending
        });
        
        // Calculate total share of dealer
        let totalShareOfDealer = 0;
        repData.forEach(person => {
            totalShareOfDealer += person.shareOfDealer;
        });
        
        // Build table with dealer separators
        let currentDealer = '';
        repData.forEach((person, index) => {
            const growthColor = parseFloat(person.growthPct) >= 0 ? 'positive' : 'negative';
            const overrideStyle = person.hasOverride ? 'background: #fff3cd; border: 2px solid #f57c00;' : '';
            
            // Check if this is a new dealer group
            const isNewDealer = person.dealer !== currentDealer;
            if (isNewDealer) {
                currentDealer = person.dealer;
                // Add thin separator line (except for the first dealer)
                if (index > 0) {
                    html += `<tr style="height: 2px; background: #ccc;"><td colspan="9" style="padding: 0;"></td></tr>`;
                }
                // Add dealer group header - compact
                html += `<tr style="background: #f8f9fa;">
                    <td colspan="9" style="padding: 4px 10px; font-weight: 700; font-size: 11px; color: var(--brand-blue); border-left: 3px solid var(--brand-blue);">
                        ${person.dealer}
                    </td>
                </tr>`;
            }
            
            html += `<tr style="line-height: 1.2;">
                <td style="padding: 4px 10px 4px 16px; font-size: 12px;"><strong>${person.name}</strong></td>
                <td style="color: #999; font-size: 10px; padding: 4px 6px;">${person.dealer}</td>
                <td class="text-right" style="padding: 4px 6px; font-size: 12px;">${fmt(person.ytd)}</td>
                <td class="text-right" style="padding: 4px 6px; font-size: 12px;">${fmt(person.annualized)}</td>
                <td class="text-right" style="padding: 4px 6px; font-size: 12px;">${person.shareOfDealer.toFixed(1)}%</td>
                <td class="text-right" style="padding: 4px 6px; font-size: 12px;">${fmt(person.dealerTarget)}</td>
                <td class="text-right" style="color: #999; padding: 4px 6px; font-size: 12px;">${fmt(person.calculatedTarget)}</td>
                <td class="text-right" style="padding: 4px 6px;">
                    <input type="number" value="${person.finalTarget}" 
                           onchange="updateSalespersonTarget('${person.name}', this.value, ${person.calculatedTarget})"
                           style="width: 70px; padding: 2px 4px; text-align: right; font-weight: 700; font-size: 11px; ${overrideStyle}">
                </td>
                <td class="text-right ${growthColor}" style="padding: 4px 6px; font-size: 12px;">${person.growthPct >= 0 ? '+' : ''}${person.growthPct}%</td>
            </tr>`;
        });
        
        // Calculate total dealer targets from unique dealers
        let totalDealerTargets = 0;
        uniqueDealers.forEach(dealerName => {
            totalDealerTargets += dealerTargets[dealerName] || 0;
        });
        
        // Calculate field sales coverage (what % of dealer field sales are covered by these salespeople)
        const totalExpectedFieldSales = totalDealerTargets * (fieldSalesRatio / 100);
        const fieldCoverage = totalExpectedFieldSales > 0 ? (totalCalculatedTarget / totalExpectedFieldSales * 100) : 0;
        
        // Total row
        const totalGrowthPct = ((totalFinalTarget / totalAnnualized - 1) * 100).toFixed(1);
        html += `<tr style="height: 2px; background: #333;"><td colspan="9" style="padding: 0;"></td></tr>`;
        html += `<tr class="total-row" style="line-height: 1.2; font-size: 12px;">
            <td colspan="2" style="padding: 6px 10px;"><strong>TOTAL (${repData.length} Salespeople)</strong></td>
            <td class="text-right" style="padding: 6px;"><strong>${fmt(totalYTD)}</strong></td>
            <td class="text-right" style="padding: 6px;"><strong>${fmt(totalAnnualized)}</strong></td>
            <td class="text-right" style="padding: 6px;"><strong>${fieldCoverage.toFixed(1)}%</strong></td>
            <td class="text-right" style="padding: 6px;"><strong>${fmt(totalDealerTargets)}</strong></td>
            <td class="text-right" style="color: #666; padding: 6px;"><strong>${fmt(totalCalculatedTarget)}</strong></td>
            <td class="text-right" style="font-weight: 700; color: #f57c00; padding: 6px;"><strong>${fmt(totalFinalTarget)}</strong></td>
            <td class="text-right ${parseFloat(totalGrowthPct) >= 0 ? 'positive' : 'negative'}" style="padding: 6px;"><strong>${parseFloat(totalGrowthPct) >= 0 ? '+' : ''}${totalGrowthPct}%</strong></td>
        </tr>`;
        
        tbody.innerHTML = html;
        
        // Update summary boxes at top
        document.getElementById('total-field-rep-targets').textContent = fmt(totalFinalTarget);
        
        // Calculate Expected Field Share = Field % x Total 2026 Strategic Target
        const baseline = DATA.totals.sales_2025_est;
        const totalLayerImpact = (layerValues.layer1 + layerValues.layer2 + layerValues.layer3 + layerValues.layer4) * 1000;
        const target2026 = baseline + totalLayerImpact;
        const expectedFieldShare = target2026 * (fieldSalesRatio / 100);
        
        document.getElementById('expected-field-share').textContent = fmt(expectedFieldShare);
        
        const variance = totalFinalTarget - expectedFieldShare;
        const varianceEl = document.getElementById('field-rep-variance');
        const varianceBox = document.getElementById('field-rep-variance-box');
        
        varianceEl.textContent = (variance >= 0 ? '+' : '') + fmt(Math.abs(variance));
        
        if (Math.abs(variance) <= 50000) {
            varianceBox.style.background = '#f0f9f0';
            varianceEl.style.color = 'var(--positive)';
        } else if (variance > 0) {
            varianceBox.style.background = '#f0f7ff';
            varianceEl.style.color = 'var(--brand-blue)';
        } else {
            varianceBox.style.background = '#fff8f0';
            varianceEl.style.color = 'var(--warning)';
        }
        
        // Update Growth Layers tab field summary
        updateFieldTotalsInGrowthLayers();
        
        // Summary
        document.getElementById('salespeople-summary').innerHTML = `
            <div class="grid-2" style="gap: 15px;">
                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">2025 Annualized</div>
                    <div style="font-size: 24px; font-weight: 700;">${fmt(totalAnnualized)}</div>
                </div>
                <div style="padding: 15px; background: #fff8e1; border-radius: 8px;">
                    <div style="font-size: 11px; color: #f57c00; text-transform: uppercase;">2026 Target (Final)</div>
                    <div style="font-size: 24px; font-weight: 700; color: #f57c00;">${fmt(totalFinalTarget)}</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 15px; background: ${(totalFinalTarget - totalAnnualized) >= 0 ? '#f0f9f0' : '#fff5f5'}; border-radius: 8px; text-align: center;">
                <div style="font-size: 11px; color: var(--text-muted);">TOTAL GROWTH</div>
                <div style="font-size: 28px; font-weight: 700; color: ${(totalFinalTarget - totalAnnualized) >= 0 ? 'var(--positive)' : 'var(--negative)'};">${(totalFinalTarget - totalAnnualized) >= 0 ? '+' : ''}${fmt(totalFinalTarget - totalAnnualized)}</div>
                <div style="font-size: 13px; color: ${parseFloat(totalGrowthPct) >= 0 ? 'var(--positive)' : 'var(--negative)'};">${parseFloat(totalGrowthPct) >= 0 ? '+' : ''}${totalGrowthPct}% vs 2025 Est</div>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: #f0f7ff; border-radius: 8px; font-size: 12px;">
                <strong>Note:</strong> Field sales = ${fieldSalesRatio}% of dealer revenue. Override individual targets as needed - changes sync back to Growth Layers.
            </div>
        `;
        
        // Dealer chart
        updateSalespeopleDealerChart(repData);
        
        // Insights
        updateSalespeopleInsights(repData);
    }
    
    function updateSalespeopleDealerChart(personData) {
        const ctx = document.getElementById('salespeopleDealerChart');
        if (!ctx) return;
        
        if (salespeopleDealerChartInstance) {
            salespeopleDealerChartInstance.destroy();
        }
        
        // Group by dealer
        const dealerTotals = {};
        personData.forEach(person => {
            if (!dealerTotals[person.dealer]) {
                dealerTotals[person.dealer] = { target: 0, annualized: 0 };
            }
            dealerTotals[person.dealer].target += person.finalTarget;
            dealerTotals[person.dealer].annualized += person.annualized;
        });
        
        const dealers = Object.keys(dealerTotals).sort((a, b) => dealerTotals[b].target - dealerTotals[a].target);
        
        salespeopleDealerChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dealers.map(d => d.length > 12 ? d.substring(0, 10) + '...' : d),
                datasets: [
                    {
                        label: '2025 Est',
                        data: dealers.map(d => dealerTotals[d].annualized / 1000),
                        backgroundColor: '#2E2E2E',
                        borderRadius: 4
                    },
                    {
                        label: '2026 Target',
                        data: dealers.map(d => dealerTotals[d].target / 1000),
                        backgroundColor: '#FF3333',
                        borderRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { callback: v => fmtChartK(v) }
                    },
                    x: {
                        ticks: { 
                            maxRotation: 45,
                            minRotation: 45,
                            font: { size: 10 }
                        }
                    }
                }
            }
        });
    }
    
    function updateSalespeopleInsights(personData) {
        // Top performers
        const topPerformers = personData.slice(0, 3);
        
        // High growth potential (high growth %)
        const highGrowth = [...personData].sort((a, b) => parseFloat(b.growthPct) - parseFloat(a.growthPct)).slice(0, 3);
        
        // Dealers without field sales
        const dealersWithSalespeople = new Set(DATA.salespeople.map(p => p.dealer));
        const dealersWithoutSalespeople = DATA.dealers.filter(d => !dealersWithSalespeople.has(d.name));
        
        let insightsHtml = `
            <div class="highlight-box" style="background: #f0f9f0; border-left: 4px solid var(--positive);">
                <div class="highlight-header green">Top Target Holders (2026)</div>
                ${topPerformers.map(p => `
                    <div class="highlight-item">
                        <strong>${p.name}</strong> - ${fmt(p.finalTarget)}${p.hasOverride ? ' <span style="color:#f57c00;">(edited)</span>' : ''}
                        <div style="font-size: 11px; color: var(--text-muted);">${p.dealer} | ${parseFloat(p.growthPct) >= 0 ? '+' : ''}${p.growthPct}% growth</div>
                    </div>
                `).join('')}
            </div>
            
            <div class="highlight-box" style="background: #f0f7ff; border-left: 4px solid var(--brand-blue);">
                <div class="highlight-header blue">Highest Growth Targets</div>
                ${highGrowth.map(p => `
                    <div class="highlight-item">
                        <strong>${p.name}</strong> - +${p.growthPct}%
                        <div style="font-size: 11px; color: var(--text-muted);">${p.dealer} | ${fmt(p.annualized)} → ${fmt(p.finalTarget)}</div>
                    </div>
                `).join('')}
            </div>
            
            <div class="highlight-box" style="background: #fff5f5; border-left: 4px solid var(--negative);">
                <div class="highlight-header red">⚠️ Dealers Without Field Sales</div>
                ${dealersWithoutSalespeople.length > 0 ? dealersWithoutSalespeople.map(d => `
                    <div class="highlight-item">
                        <strong>${d.name}</strong> (${d.region})
                        <div style="font-size: 11px; color: var(--text-muted);">2025 Sales: ${fmt(d.sales_2025)} - No salesperson assigned</div>
                    </div>
                `).join('') : '<div class="highlight-item" style="color: var(--positive);">All dealers have field sales coverage!</div>'}
            </div>
        `;
        
        document.getElementById('salespeople-insights').innerHTML = insightsHtml;
    }
    
    // =====================================================================
    // CHARTS
    // =====================================================================
    
    function initCharts() {
        // Trend Chart
        new Chart(document.getElementById('trendChart'), {
            type: 'bar',
            data: {
                labels: ['2022', '2023', '2024', '2025 Est', '2026 Target'],
                datasets: [{
                    label: 'Total Sales',
                    data: [3.57, 3.74, 4.52, 4.19, 4.61],
                    backgroundColor: ['#00AEEF', '#00AEEF', '#00AEEF', '#f59e0b', '#FF3333'],
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 5,
                        ticks: { callback: v => '€' + v + 'M' }
                    }
                }
            }
        });
        
        // Growth Chart
        new Chart(document.getElementById('growthChart'), {
            type: 'doughnut',
            data: {
                labels: ['New Products', 'Dealer Incentives', 'Field Expansion', 'Organic'],
                datasets: [{
                    data: [350, 84, 42, 43],
                    backgroundColor: ['#FF3333', '#00AEEF', '#28a745', '#f59e0b'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    }
    
    // =====================================================================
    // EXPORT
    // =====================================================================
    
    function exportAll() {
        exportTargets();
    }
    
    function exportTargets() {
        let csv = 'Dealer,Region,' + MATRIX_SUPPLIERS.join(',') + ',TOTAL,Growth%\n';
        
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || MATRIX_SUPPLIERS.map(() => 0);
            let rowTotal = 0;
            const targets = MATRIX_SUPPLIERS.map((sup, i) => {
                const baseline = matrix[i] || 0;
                const target = Math.round(baseline * targetMultipliers[dealer.name][sup]);
                rowTotal += target;
                return target;
            });
            
            const baseline = matrix.reduce((a, b) => a + b, 0);
            const growth = baseline > 0 ? ((rowTotal / baseline - 1) * 100).toFixed(1) : 0;
            
            csv += `"${dealer.name}","${dealer.region}",${targets.join(',')},${rowTotal},${growth}%\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'XYZ Distribution_2026_Targets.csv';
        a.click();
    }
    
    // =====================================================================
    // INIT
    // =====================================================================
    
    document.addEventListener('DOMContentLoaded', function() {
        initCharts();
        loadFromLocalStorage(); // Load saved data first (including layer values)
        updateLayers(true); // Refresh layer calculations + recalculate new supplier targets + populate matrix (skip save on init)
        calculatePL(); // Refresh P&L calculations
    });
    
    // =====================================================================
    // BACKUP / RESTORE / EXPORT FUNCTIONS
    // =====================================================================
    
    function downloadBackup() {
        const dataToSave = {
            version: '1.0',
            exportedAt: new Date().toISOString(),
            targetMultipliers: targetMultipliers,
            absoluteTargets: absoluteTargets,
            growthLayers: {
                layer1: document.getElementById('layer1')?.value || 400,
                layer2: document.getElementById('layer2')?.value || 100,
                layer3: document.getElementById('layer3')?.value || 50,
                layer4: document.getElementById('layer4')?.value || 100
            },
            plInputs: {
                revenue: document.getElementById('pl-revenue')?.value || 4613677,
                cogs: document.getElementById('pl-cogs')?.value || 65,
                opex: document.getElementById('pl-opex')?.value || 350000,
                other: document.getElementById('pl-other')?.value || 50000
            },
            fieldSalesRatio: fieldSalesRatio,
            salespersonOverrides: salespersonOverrides
        };
        
        const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const date = new Date().toISOString().split('T')[0];
        a.href = url;
        a.download = `XYZ Distribution_Backup_${date}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        updateSaveIndicator();
        showNotification('Backup downloaded! Keep this file safe to restore your work.', 'success');
    }
    
    function restoreBackup(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                // Restore target multipliers
                if (data.targetMultipliers) {
                    Object.assign(targetMultipliers, data.targetMultipliers);
                }
                
                // Restore absolute targets (for 0-baseline items like New Suppliers)
                if (data.absoluteTargets) {
                    Object.assign(absoluteTargets, data.absoluteTargets);
                }
                
                // Restore growth layers
                if (data.growthLayers) {
                    const layers = data.growthLayers;
                    if (document.getElementById('layer1')) {
                        document.getElementById('layer1').value = layers.layer1 || 400;
                        document.getElementById('layer1-value').textContent = layers.layer1 || 400;
                        layerValues.layer1 = parseInt(layers.layer1) || 400;
                    }
                    if (document.getElementById('layer2')) {
                        document.getElementById('layer2').value = layers.layer2 || 100;
                        document.getElementById('layer2-value').textContent = layers.layer2 || 100;
                        layerValues.layer2 = parseInt(layers.layer2) || 100;
                    }
                    if (document.getElementById('layer3')) {
                        document.getElementById('layer3').value = layers.layer3 || 50;
                        document.getElementById('layer3-value').textContent = layers.layer3 || 50;
                        layerValues.layer3 = parseInt(layers.layer3) || 50;
                    }
                    if (document.getElementById('layer4')) {
                        document.getElementById('layer4').value = layers.layer4 || 100;
                        document.getElementById('layer4-value').textContent = layers.layer4 || 100;
                        layerValues.layer4 = parseInt(layers.layer4) || 100;
                    }
                }
                
                // Restore P&L inputs
                if (data.plInputs) {
                    if (document.getElementById('pl-revenue')) document.getElementById('pl-revenue').value = data.plInputs.revenue;
                    if (document.getElementById('pl-cogs')) document.getElementById('pl-cogs').value = data.plInputs.cogs;
                    if (document.getElementById('pl-opex')) document.getElementById('pl-opex').value = data.plInputs.opex;
                    if (document.getElementById('pl-other')) document.getElementById('pl-other').value = data.plInputs.other;
                }
                
                // Refresh all views
                populateTargetMatrix();
                updateGrowthLayers();
                calculatePL();
                populateRegionalView();
                populateSupplierAnalysis();
                populateSalespeopleView();
                saveToLocalStorage(true); // Silent save
                
                showNotification('Backup restored successfully! All your targets have been loaded.', 'success');
            } catch (err) {
                showNotification('Error reading backup file. Please check the file is valid.', 'error');
                console.error(err);
            }
        };
        reader.readAsText(file);
        event.target.value = ''; // Reset file input
    }
    
    function exportToExcel() {
        if (typeof XLSX === 'undefined') {
            showNotification('Excel library not loaded. Please check your internet connection and refresh.', 'error');
            return;
        }
        
        // =====================================================
        // SHEET 1: DEALER x SUPPLIER TARGETS (Full Matrix)
        // =====================================================
        let grandBaseline = 0;
        let grandTarget = 0;
        
        const dealerHeaders = ['DEALER', ...MATRIX_SUPPLIERS, 'TOTAL 2025 (€)', 'TOTAL 2026 (€)', 'GROWTH (€)'];
        const dealerData = [
            ['XYZ Distribution 2026 - Dealer x Supplier Targets'],
            ['Generated: ' + new Date().toLocaleDateString()],
            [''],
            dealerHeaders
        ];
        
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            const row = [dealer.name];
            let dealerBaseline = 0, dealerTarget = 0;
            
            matrix.forEach((baseline, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                const target = Math.round(baseline * mult);
                row.push(target * 1000); // Push 2026 target in €
                dealerBaseline += baseline;
                dealerTarget += target;
            });
            
            grandBaseline += dealerBaseline;
            grandTarget += dealerTarget;
            
            row.push(dealerBaseline * 1000);
            row.push(dealerTarget * 1000);
            row.push((dealerTarget - dealerBaseline) * 1000);
            dealerData.push(row);
        });
        
        // Add totals row
        const totalRow = ['TOTAL'];
        MATRIX_SUPPLIERS.forEach(supplier => {
            let supplierTotal = 0;
            DATA.dealers.forEach(dealer => {
                const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
                const idx = MATRIX_SUPPLIERS.indexOf(supplier);
                if (idx >= 0 && matrix[idx]) {
                    const mult = targetMultipliers[dealer.name]?.[supplier] || 1.1;
                    supplierTotal += Math.round(matrix[idx] * mult);
                }
            });
            totalRow.push(supplierTotal * 1000);
        });
        totalRow.push(grandBaseline * 1000);
        totalRow.push(grandTarget * 1000);
        totalRow.push((grandTarget - grandBaseline) * 1000);
        dealerData.push(totalRow);
        
        // =====================================================
        // SHEET 2: SALESPERSON TARGETS
        // =====================================================
        
        // First calculate dealer targets (needed for salesperson calculations)
        const dealerTargetsMap = {};
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            let total = 0;
            matrix.forEach((baseline, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                total += Math.round(baseline * mult);
            });
            dealerTargetsMap[dealer.name] = total * 1000;
        });
        
        const salespersonHeaders = ['SALESPERSON', 'DEALER', '2025 YTD (€)', '2025 ANNUALIZED (€)', '% OF DEALER', '2026 TARGET (€)', 'GROWTH %'];
        const salespersonData = [
            ['XYZ Distribution 2026 - Salesperson Targets'],
            ['Generated: ' + new Date().toLocaleDateString()],
            ['Field Sales = 69.4% of dealer revenue'],
            [''],
            salespersonHeaders
        ];
        
        let totalYTD = 0, totalTarget = 0;
        
        DATA.salespeople.forEach(person => {
            const ytd = person.sales_2025_ytd;
            const annualized = Math.round(ytd * (12 / 10)); // Annualize Jan-Oct
            
            // Get dealer's field sales for 2025 (YTD)
            const dealerFieldSales = DATA.fieldSalesByDealer[person.dealer] || 1;
            const personShareOfDealer = ytd / dealerFieldSales;
            
            // Get dealer's 2026 target
            const dealerTarget = dealerTargetsMap[person.dealer] || 0;
            
            // Salesperson's share of dealer's field sales portion
            const dealerFieldTarget = dealerTarget * DATA.fieldSalesRatio;
            
            // Salesperson's 2026 target
            const personTarget2026 = Math.round(dealerFieldTarget * personShareOfDealer);
            
            // Growth %
            const growthPct = annualized > 0 ? ((personTarget2026 / annualized - 1) * 100).toFixed(1) : 0;
            
            totalYTD += ytd;
            totalTarget += personTarget2026;
            
            salespersonData.push([
                person.name,
                person.dealer,
                ytd,
                annualized,
                (personShareOfDealer * 100).toFixed(1) + '%',
                personTarget2026,
                growthPct + '%'
            ]);
        });
        
        // Add totals row for salespeople
        salespersonData.push([
            'TOTAL',
            '',
            totalYTD,
            Math.round(totalYTD * (12/10)),
            '',
            totalTarget,
            ((totalTarget / (totalYTD * 12/10) - 1) * 100).toFixed(1) + '%'
        ]);
        
        // =====================================================
        // CREATE WORKBOOK WITH 2 SHEETS
        // =====================================================
        const wb = XLSX.utils.book_new();
        
        const ws1 = XLSX.utils.aoa_to_sheet(dealerData);
        XLSX.utils.book_append_sheet(wb, ws1, 'Dealer-Supplier Targets');
        
        const ws2 = XLSX.utils.aoa_to_sheet(salespersonData);
        XLSX.utils.book_append_sheet(wb, ws2, 'Salesperson Targets');
        
        // Download
        XLSX.writeFile(wb, 'XYZ Distribution_2026_Targets.xlsx');
        showNotification('Excel exported with Dealer-Supplier and Salesperson targets.', 'success');
    }
    
    function generateFullReport() {
        // Get current target data
        let grandBaseline = 0;
        let grandTarget = 0;
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            matrix.forEach((baseline, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                grandBaseline += baseline;
                grandTarget += Math.round(baseline * mult);
            });
        });
        const growth = grandTarget - grandBaseline;
        const growthPct = ((grandTarget / grandBaseline - 1) * 100).toFixed(1);
        
        // Get growth layer values (actual slider IDs)
        const layer1Val = document.getElementById('layer1')?.value || 400;
        const layer2Val = document.getElementById('layer2')?.value || 100;
        const layer3Val = document.getElementById('layer3')?.value || 50;
        const layer4Val = document.getElementById('layer4')?.value || 100;
        
        // Get ALL dealer targets (sorted)
        const dealerTargets = [];
        DATA.dealers.forEach(dealer => {
            const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
            let baseline = 0, target = 0;
            const supplierTargets = {};
            matrix.forEach((b, i) => {
                const mult = targetMultipliers[dealer.name]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                baseline += b;
                target += Math.round(b * mult);
                supplierTargets[MATRIX_SUPPLIERS[i]] = Math.round(b * mult) * 1000;
            });
            dealerTargets.push({ name: dealer.name, baseline, target, growth: target - baseline, supplierTargets });
        });
        dealerTargets.sort((a, b) => b.target - a.target);
        
        // Get P&L values
        const revenue = grandTarget * 1000;
        const cogsRate = parseFloat(document.getElementById('pl-cogs')?.value || 65) / 100;
        const opex = parseFloat(document.getElementById('pl-opex')?.value || 350000);
        const other = parseFloat(document.getElementById('pl-other')?.value || 50000);
        const grossMargin = revenue * (1 - cogsRate);
        const netProfit = grossMargin - opex - other;
        
        // Build supplier totals
        const supplierTotals = {};
        MATRIX_SUPPLIERS.forEach(supplier => {
            supplierTotals[supplier] = { baseline: 0, target: 0 };
            DATA.dealers.forEach(dealer => {
                const matrix = DEALER_SUPPLIER_MATRIX[dealer.name] || [];
                const idx = MATRIX_SUPPLIERS.indexOf(supplier);
                if (idx >= 0 && matrix[idx]) {
                    const mult = targetMultipliers[dealer.name]?.[supplier] || 1.1;
                    supplierTotals[supplier].baseline += matrix[idx];
                    supplierTotals[supplier].target += Math.round(matrix[idx] * mult);
                }
            });
        });
        
        // Regional data
        const REGIONS = [
            { name: 'Region A', dealers: ['Dealer 1', 'Dealer 2', 'Dealer 3', 'Dealer 4', 'Dealer 6', 'Dealer 11', 'Dealer 12'], customerPct: 45.2 },
            { name: 'Region B', dealers: ['Dealer 5', 'Dealer 8', 'Dealer 9'], customerPct: 17.8 },
            { name: 'Region C', dealers: ['Dealer 10'], customerPct: 6.2 },
            { name: 'Region D', dealers: [], customerPct: 5.8 },
            { name: 'Region E', dealers: ['Dealer 14'], customerPct: 5.5 },
            { name: 'Region F', dealers: ['Dealer 13'], customerPct: 0 }
        ];
        
        const regionRows = REGIONS.map(region => {
            let regionBaseline = 0, regionTarget = 0;
            region.dealers.forEach(dealerName => {
                const matrix = DEALER_SUPPLIER_MATRIX[dealerName] || [];
                matrix.forEach((b, i) => {
                    const mult = targetMultipliers[dealerName]?.[MATRIX_SUPPLIERS[i]] || 1.1;
                    regionBaseline += b;
                    regionTarget += Math.round(b * mult);
                });
            });
            const pctCompany = grandBaseline > 0 ? ((regionBaseline / grandBaseline) * 100).toFixed(1) : '0.0';
            const penetration = region.customerPct > 0 ? (parseFloat(pctCompany) / region.customerPct).toFixed(2) : '-';
            return `<tr>
                <td>${region.name}</td>
                <td style="font-size: 9px;">${region.dealers.join(', ') || '-'}</td>
                <td class="right">${fmtK(regionBaseline * 1000)}</td>
                <td class="right">${pctCompany}%</td>
                <td class="right">${region.customerPct}%</td>
                <td class="right" style="font-weight: 600;">${penetration}</td>
                <td class="right" style="font-weight: 600; color: #28a745;">${fmtK(regionTarget * 1000)}</td>
            </tr>`;
        }).join('');
        
        // Create comprehensive report HTML
        const reportHTML = `
<!DOCTYPE html>
<html>
<head>
    <title>XYZ Distribution 2026 Strategic Plan - Complete Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; line-height: 1.4; color: #333; padding: 25px; max-width: 1000px; margin: 0 auto; }
        
        .cover { text-align: center; padding: 60px 0; border-bottom: 3px solid #FF3333; margin-bottom: 30px; }
        .cover h1 { font-size: 36px; color: #2E2E2E; margin-bottom: 10px; }
        .cover h1 span { color: #FF3333; }
        .cover .subtitle { color: #666; font-size: 14px; }
        .cover .date { margin-top: 20px; font-size: 12px; color: #999; }
        
        h2 { font-size: 16px; color: #2E2E2E; margin: 30px 0 15px; padding-bottom: 8px; border-bottom: 2px solid #FF3333; page-break-after: avoid; }
        h3 { font-size: 13px; color: #2E2E2E; margin: 20px 0 10px; }
        
        .metrics { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .metric { flex: 1; min-width: 150px; background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-top: 3px solid #00AEEF; }
        .metric.red { border-top-color: #FF3333; }
        .metric.green { border-top-color: #28a745; }
        .metric-value { font-size: 20px; font-weight: 700; color: #2E2E2E; }
        .metric-label { font-size: 9px; color: #666; margin-top: 2px; }
        
        table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 10px; }
        th { background: #2E2E2E; color: white; padding: 8px 6px; text-align: left; font-weight: 600; font-size: 9px; }
        th.right { text-align: right; }
        td { padding: 6px; border-bottom: 1px solid #eee; }
        td.right { text-align: right; }
        tr:nth-child(even) { background: #f8f9fa; }
        .total-row { background: #2E2E2E !important; color: white; font-weight: 700; }
        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        
        .note { background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 3px solid #ffc107; margin: 12px 0; font-size: 10px; }
        .info { background: #e7f3ff; padding: 10px; border-radius: 6px; border-left: 3px solid #00AEEF; margin: 12px 0; font-size: 10px; }
        
        .two-col { display: flex; gap: 20px; }
        .two-col > div { flex: 1; }
        
        .footer { margin-top: 40px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 9px; color: #999; text-align: center; }
        
        .page-break { page-break-before: always; }
        .no-break { page-break-inside: avoid; }
        
        .badge { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 8px; font-weight: 600; }
        .badge-green { background: #d4edda; color: #155724; }
        .badge-red { background: #f8d7da; color: #721c24; }
        .badge-yellow { background: #fff3cd; color: #856404; }
        .badge-blue { background: #cce5ff; color: #004085; }
        
        @media print { 
            body { padding: 15px; font-size: 10px; } 
            .cover { padding: 40px 0; }
            .page-break { page-break-before: always; }
            table { font-size: 9px; }
        }
        
        .print-instruction { background: #28a745; color: white; padding: 15px; text-align: center; margin-bottom: 20px; border-radius: 6px; }
        @media print { .print-instruction { display: none; } }
    </style>
</head>
<body>
    <div class="print-instruction">
        <strong>To save as PDF:</strong> Press Cmd+P (Mac) or Ctrl+P (Windows), then select "Save as PDF" as the destination.
    </div>

    <div class="cover">
        <h1>XYZ <span>Distribution</span></h1>
        <div class="subtitle">2026 Strategic Plan - Complete Report</div>
        <div class="date">Generated: ${new Date().toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
    </div>
    
    <h2>1. Executive Summary</h2>
    <div class="metrics">
        <div class="metric">
            <div class="metric-value">€4.19M</div>
            <div class="metric-label">2025 Full Year Estimate</div>
        </div>
        <div class="metric red">
            <div class="metric-value">${fmtK(grandTarget * 1000)}</div>
            <div class="metric-label">2026 Target</div>
        </div>
        <div class="metric green">
            <div class="metric-value">+${fmtK(growth * 1000)}</div>
            <div class="metric-label">Growth (+${growthPct}%)</div>
        </div>
        <div class="metric">
            <div class="metric-value">${fmt(netProfit)}</div>
            <div class="metric-label">Projected Net Profit</div>
        </div>
    </div>
    <div class="note">
        <strong>Key Insight:</strong> 84% of the 2025 decline came from Non-Dealers. The dealer network grew +1%, demonstrating resilience. The 2026 strategy focuses on dealer expansion and supplier optimization.
    </div>
    
    <h2>2. Growth Layer Strategy</h2>
    <div class="two-col no-break">
        <div>
            <table>
                <tr><th>Growth Layer</th><th class="right">Contribution</th></tr>
                <tr><td>New Products</td><td class="right">+€${layer1Val}K</td></tr>
                <tr><td>Dealer Incentives</td><td class="right">+€${layer2Val}K</td></tr>
                <tr><td>Field Sales Expansion</td><td class="right">+€${layer3Val}K</td></tr>
                <tr><td>Customer Promotions</td><td class="right">+€${layer4Val}K</td></tr>
                <tr class="total-row"><td>TOTAL LAYER GROWTH</td><td class="right">+€${parseInt(layer1Val)+parseInt(layer2Val)+parseInt(layer3Val)+parseInt(layer4Val)}K</td></tr>
            </table>
        </div>
        <div>
            <div class="info">
                <strong>Growth Strategy:</strong> The target of +${growthPct}% is distributed across four strategic layers. Each layer represents a distinct growth driver that can be independently managed and tracked.
            </div>
        </div>
    </div>
    
    <h2 class="page-break">3. Complete Dealer Target Matrix</h2>
    <p style="margin-bottom: 10px; color: #666;">All 14 dealers with 2026 targets by supplier (in €K)</p>
    <table>
        <tr>
            <th>Dealer</th>
            <th class="right">2025 Baseline</th>
            <th class="right">2026 Target</th>
            <th class="right">Growth</th>
            <th class="right">Growth %</th>
        </tr>
        ${dealerTargets.map(d => `
        <tr>
            <td>${d.name}</td>
            <td class="right">${fmtK(d.baseline * 1000)}</td>
            <td class="right" style="font-weight: 600;">${fmtK(d.target * 1000)}</td>
            <td class="right positive">+${fmtK(d.growth * 1000)}</td>
            <td class="right positive">+${((d.target / d.baseline - 1) * 100).toFixed(1)}%</td>
        </tr>`).join('')}
        <tr class="total-row">
            <td>GRAND TOTAL</td>
            <td class="right">${fmtK(grandBaseline * 1000)}</td>
            <td class="right">${fmtK(grandTarget * 1000)}</td>
            <td class="right">+${fmtK(growth * 1000)}</td>
            <td class="right">+${growthPct}%</td>
        </tr>
    </table>
    
    <h2>4. Regional Analysis</h2>
    <table class="no-break">
        <tr>
            <th>Region</th>
            <th>Dealers</th>
            <th class="right">2025 Sales</th>
            <th class="right">% XYZ Distribution</th>
            <th class="right">% GR Customers</th>
            <th class="right">Penetration</th>
            <th class="right">2026 Target</th>
        </tr>
        ${regionRows}
    </table>
    <div class="info">
        <strong>Penetration Index:</strong> Ratio of XYZ Distribution market share to regional customer population. Values >1.0 indicate over-penetration, <1.0 indicates growth opportunity.
    </div>
    
    <h2 class="page-break">5. Supplier Strategy</h2>
    <table class="no-break">
        <tr>
            <th>Supplier</th>
            <th class="right">2025 Sales</th>
            <th class="right">2026 Target</th>
            <th class="right">Growth</th>
            <th>Classification</th>
            <th>Strategy</th>
        </tr>
        ${Object.entries(supplierTotals).map(([name, data]) => {
            const supplierInfo = DATA.suppliers.find(s => s.name === name) || {};
            const growthAmt = data.target - data.baseline;
            const classification = supplierInfo.class || 'STABLE';
            const strategy = classification === 'DOUBLE WIN' ? 'Maximize' : classification === 'VOLUME LED' ? 'Push Volume' : classification === 'PRICE COLLAPSE' ? 'Fix Pricing' : classification === 'VOLUME COLLAPSE' ? 'Stabilize' : 'Maintain';
            const badgeClass = classification === 'DOUBLE WIN' ? 'badge-green' : classification === 'VOLUME LED' ? 'badge-blue' : classification.includes('COLLAPSE') ? 'badge-red' : 'badge-yellow';
            return `
        <tr>
            <td>${name}</td>
            <td class="right">${fmtK(data.baseline * 1000)}</td>
            <td class="right" style="font-weight: 600;">${fmtK(data.target * 1000)}</td>
            <td class="right positive">+${fmtK(growthAmt * 1000)}</td>
            <td><span class="badge ${badgeClass}">${classification}</span></td>
            <td>${strategy}</td>
        </tr>`;
        }).join('')}
    </table>
    
    <h2>6. P&L Projection</h2>
    <table class="no-break" style="max-width: 500px;">
        <tr><th colspan="2">2026 Projected P&L</th></tr>
        <tr><td style="font-weight: 600;">Revenue</td><td class="right" style="font-size: 13px; font-weight: 700;">${fmt(revenue)}</td></tr>
        <tr><td>Cost of Goods Sold (${(cogsRate * 100).toFixed(0)}%)</td><td class="right negative">-${fmt(revenue * cogsRate)}</td></tr>
        <tr style="background: #d4edda;"><td style="font-weight: 600;">Gross Margin</td><td class="right positive" style="font-weight: 700;">${fmt(grossMargin)} (${((1-cogsRate)*100).toFixed(0)}%)</td></tr>
        <tr><td>Operating Expenses</td><td class="right negative">-${fmt(opex)}</td></tr>
        <tr><td>Other Costs</td><td class="right negative">-${fmt(other)}</td></tr>
        <tr class="total-row"><td>NET PROFIT</td><td class="right" style="font-size: 13px;">${fmt(netProfit)} (${((netProfit/revenue)*100).toFixed(1)}%)</td></tr>
    </table>
    
    <div class="footer">
        <p><strong>XYZ Distribution CEO Portal</strong> | Strategic Planning 2026</p>
        <p>This report was generated from the CEO Portal with your current target settings.</p>
        <p>Confidential - For Internal Use Only</p>
    </div>
</body>
</html>`;
        
        // Open in new window
        const reportWindow = window.open('', '_blank');
        reportWindow.document.write(reportHTML);
        reportWindow.document.close();
        
        showNotification('Full report opened - Press Cmd/Ctrl+P to save as PDF', 'success');
    }
    
    function updateSaveIndicator() {
        const indicator = document.getElementById('save-indicator');
        if (indicator) {
            const now = new Date();
            indicator.textContent = `Saved: ${now.toLocaleTimeString()}`;
        }
    }
    
    // =====================================================================
    // SAVE / LOAD FUNCTIONALITY
    // =====================================================================
    
    const STORAGE_KEY = 'xyz_distribution_ceo_portal_data';
    
    function saveToLocalStorage(silent = false) {
        const dataToSave = {
            targetMultipliers: targetMultipliers,
            absoluteTargets: absoluteTargets,
            growthLayers: {
                layer1: document.getElementById('layer1')?.value || 400,
                layer2: document.getElementById('layer2')?.value || 100,
                layer3: document.getElementById('layer3')?.value || 50,
                layer4: document.getElementById('layer4')?.value || 100
            },
            plInputs: {
                revenue: document.getElementById('pl-revenue')?.value || 4613677,
                cogs: document.getElementById('pl-cogs')?.value || 65,
                opex: document.getElementById('pl-opex')?.value || 350000,
                other: document.getElementById('pl-other')?.value || 50000
            },
            fieldSalesRatio: fieldSalesRatio,
            salespersonOverrides: salespersonOverrides,
            savedAt: new Date().toISOString()
        };
        
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
        updateSaveIndicator();
        if (!silent) {
            showNotification('Saved successfully!', 'success');
        }
    }
    
    function loadFromLocalStorage() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        
        try {
            const data = JSON.parse(saved);
            
            // Restore target multipliers
            if (data.targetMultipliers) {
                Object.assign(targetMultipliers, data.targetMultipliers);
            }
            
            // Restore absolute targets (for 0-baseline items like New Suppliers)
            if (data.absoluteTargets) {
                Object.assign(absoluteTargets, data.absoluteTargets);
            }
            
            // Restore growth layers (correct slider IDs)
            if (data.growthLayers) {
                const layers = data.growthLayers;
                if (document.getElementById('layer1')) {
                    document.getElementById('layer1').value = layers.layer1 || 350;
                    document.getElementById('layer1-value').textContent = layers.layer1 || 350;
                    layerValues.layer1 = parseInt(layers.layer1) || 350;
                }
                if (document.getElementById('layer2')) {
                    document.getElementById('layer2').value = layers.layer2 || 85;
                    document.getElementById('layer2-value').textContent = layers.layer2 || 85;
                    layerValues.layer2 = parseInt(layers.layer2) || 85;
                }
                if (document.getElementById('layer3')) {
                    document.getElementById('layer3').value = layers.layer3 || 42;
                    document.getElementById('layer3-value').textContent = layers.layer3 || 42;
                    layerValues.layer3 = parseInt(layers.layer3) || 42;
                }
                if (document.getElementById('layer4')) {
                    document.getElementById('layer4').value = layers.layer4 || 0;
                    document.getElementById('layer4-value').textContent = layers.layer4 || 0;
                    layerValues.layer4 = parseInt(layers.layer4) || 0;
                }
            }
            
            // Restore P&L inputs
            if (data.plInputs) {
                if (document.getElementById('pl-revenue')) document.getElementById('pl-revenue').value = data.plInputs.revenue;
                if (document.getElementById('pl-cogs')) document.getElementById('pl-cogs').value = data.plInputs.cogs;
                if (document.getElementById('pl-opex')) document.getElementById('pl-opex').value = data.plInputs.opex;
                if (document.getElementById('pl-other')) document.getElementById('pl-other').value = data.plInputs.other;
            }
            
            // Restore field sales ratio
            if (data.fieldSalesRatio !== undefined) {
                fieldSalesRatio = data.fieldSalesRatio;
                if (document.getElementById('field-sales-ratio')) {
                    document.getElementById('field-sales-ratio').value = fieldSalesRatio;
                }
                if (document.getElementById('field-ratio-display')) {
                    document.getElementById('field-ratio-display').textContent = fieldSalesRatio.toFixed(1);
                }
            }
            
            // Restore salesperson overrides
            if (data.salespersonOverrides) {
                salespersonOverrides = data.salespersonOverrides;
            }
            
            console.log('Loaded saved data from:', data.savedAt);
            updateSaveIndicator();
        } catch (e) {
            console.error('Error loading saved data:', e);
        }
    }
    
    
    function resetAllData() {
        if (!confirm('Are you sure you want to reset all data to defaults? This cannot be undone.')) {
            return;
        }
        
        // Clear localStorage
        localStorage.removeItem(STORAGE_KEY);
        
        // Reset target multipliers to default 1.1
        Object.keys(targetMultipliers).forEach(dealer => {
            Object.keys(targetMultipliers[dealer]).forEach(supplier => {
                targetMultipliers[dealer][supplier] = 1.1;
            });
        });
        
        // Reset absolute targets (for New Suppliers) to initial values
        DATA.dealers.forEach(d => {
            const matrix = DEALER_SUPPLIER_MATRIX[d.name] || [];
            absoluteTargets[d.name] = {
                'New Supplier 1': matrix[10] || 0,
                'New Supplier 2': matrix[11] || 0
            };
        });
        
        // Reset layer sliders to new defaults
        const layerDefaults = { layer1: 400, layer2: 100, layer3: 50, layer4: 100 };
        Object.keys(layerDefaults).forEach(id => {
            const slider = document.getElementById(id);
            const valueEl = document.getElementById(id + '-value');
            if (slider) slider.value = layerDefaults[id];
            if (valueEl) valueEl.textContent = layerDefaults[id];
            layerValues[id] = layerDefaults[id];
        });
        
        // Reset P&L inputs
        if (document.getElementById('pl-revenue')) document.getElementById('pl-revenue').value = 4613677;
        if (document.getElementById('pl-cogs')) document.getElementById('pl-cogs').value = 65;
        if (document.getElementById('pl-opex')) document.getElementById('pl-opex').value = 350000;
        if (document.getElementById('pl-other')) document.getElementById('pl-other').value = 50000;
        
        // Reset field sales ratio
        fieldSalesRatio = 69.4;
        if (document.getElementById('field-sales-ratio')) document.getElementById('field-sales-ratio').value = 69.4;
        if (document.getElementById('field-ratio-display')) document.getElementById('field-ratio-display').textContent = '69.4';
        
        // Reset salesperson overrides
        salespersonOverrides = {};
        
        // Refresh views
        populateTargetMatrix();
        updateGrowthLayers();
        calculatePL();
        
        showNotification('Reset to defaults!', 'success');
    }
    
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: ${type === 'success' ? 'var(--positive)' : 'var(--negative)'};
            color: white;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 2000);
    }
    
    // Auto-save on any input change (silent)
    document.addEventListener('change', function(e) {
        if (e.target.matches('input')) {
            saveToLocalStorage(true);
        }
    });
    
    // Add CSS animation for notifications
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>
